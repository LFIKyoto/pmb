************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.7                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


------------
Acquisitions
------------

#61674 : Retours à la ligne dans le champ commentaire des fournisseurs
Conservation des retours à la ligne dans le champ commentaire d'un fournisseur.

#62259 : Page blanche en suppression de fournisseur
Affichage de la boite pour forcer la suppression.

#62261 : Liste des fournisseurs / modification du nombre de résultats par page
Prise en compte de la personnalisation du nombre de résultats par page.

#62385 : Paiement d'une facture
Lors du paiement de la facture :
- Passage de la commande en "soldé / payé" lorsque celle-ci est "soldé / facturé".

#62409 : Factures / incohérence saisie HT/TTC
Gestion de la TVA avec saisie des prix TTC :
- Saisie en TTC lors de la facturation

#62543 : Evolution style pure - Acquisition
Amélioration du style pure pour le tableau de suivi de budget

#65082 : Limitation de la duplication et du transfert de lignes de commandes
Suppression de la possibilité de transférer l'ensemble des lignes d'une commande vers une autre.
Suppression de la possibilité de transférer / dupliquer des lignes non enregistrées.
Limitation du transfert / de la duplication des lignes vers des commandes "à valider".
Limitation de la possibilité de transférer des lignes depuis une commande "à valider".

#65710 : Edition d'une commande : Archivage
Affichage du bouton "Archiver" dès lors que la commande est soldée.

--------------
Administration
--------------

#60117 : Recherche prédéfinie OPAC
De nouveau fonctionnelle.

#60626 : Optimisations formulaire de contact
- Affichages tronqués
- Enregistrement des valeurs de paramétrage

#62025 : Quotas sur les nouveautés
Élimination des doublons de valeurs "Oui" et "Non".

#62145 : Mise à jour documentation d'import des catégories
Mise à jour de la documentation pour l'import des catégories dans PMB à partir d'un fichier de structure XML (pmb/doc/Import_categories_rameau.pdf)

#62232 : [Connecteurs] Import de fichiers
Correction sur le double import des informations du guide.

#62579 : [Webservices] catalog_subst
Il n'était plus pris en compte.

#63627 : [Planificateur de tâches] Synchronisation
Ne pas tenir compte des dates de début et fin lors d'une synchronisation globale de toutes les notices.

#63772 : URL des vignettes de notice dans les connecteurs
Les URL de vignettes de notice dans les connecteurs n'étaient pas toujours fonctionnelles à cause du paramètre empr_pic qui ne devrait pas y être

#65019 : Calcul des index phonétiques via le planificateur des tâches
Le calcul des index phonétiques lors du nettoyage de la base via le planificateur des tâches n'était pas fonctionnel.

#65246 : Conversion RIS
Modification pour ne pas bloquer la conversion des notices dans le format RIS vers le format pmb-XML MARC ou UNIMARC ISO2709 lorsque l'ISBN n'est pas valide.
Le message d'erreur est cependant toujours affiché.

---------
Autorités
---------

#59393 : Affichage des champs perso de concepts
Afficher les champs perso de concepts en visualisation

#59773 : Affichage du statut de concept
Le lien rdf du statut est exclu de l'affichage de concept

#59854 : [Réindexation par paniers] Action sur le bouton "Vider le panier"
Le bouton dans la partie "Autorités" pointait sur l'onglet Catalogue, historiquement le seul.

#59942 : Réindexation d'un concept par panier
Réindexation d'un concept sur un panier mixte ou un panier de concept
Réindexation d'une autorité perso sur un panier mixte

#60076 : Recherche concept en gestion et opac
Le résultat de recherche diffère entr el'opac et la gestion
Le comptage du nombre de résultat en Opac est erroné

#60122 : Subst types et natures de titre uniforme
Les valeurs vides dans la substitution étaient conservées.

#60459 : Problème de sélection des types de documents pour les plans de classement
Correction sur la sélection des types de documents.

#61852 : [Indexation décimale] Option de recherche
Correction sur la sélection des options "Recherche sur l'index" et "Recherche sur le commentaire".

#61874 : Ordre d'affichage des vedettes d'un concept composé 
En affichage d'un concept composé, les vedettes respectent l'ordre 'subdivision' du xml de vedette

#62888 : CP d'autorités : Antiloop
Gestion de l'antiloop dans la récupération des informations d'autorités avec rebond sur elles-mêmes.

#64333 : Enregistrement des qualifications dans une oeuvre 
Enregistrement de toutes les qualifications dans une ?uvre

---------
Catalogue
---------

#58841 : Interrogation z39.50 via les connecteurs
Lors de l'interrogation de base distante z39.50 via le connecteur entrant prévu à cet effet l'encodage des caractères dans PMB n'était pas toujours cohérent avec ce qui était envoyé par les sources distante notamment pour le SUDOC.

#59037 : Grilles éditables instables sur les exemplaires
Amélioration du formatage des grilles d'exemplaires.

#59252 : Affichage des exemplaires suite à l'upload d'un document numérique
Les exemplaires n'étaient plus affichés à l'upload d'un document numérique.

#59730 : Critère "Doublons ISBN du dernier import"
Association d'un groupe au critère spécial dans le fichier XML de multi-critères.

#59823 : [Upload] Taille maximale de la vignette
Elle ne sera désormais plus limitée à 1Mo.

#60127 : Popup de transferts : Fatal Error
Correction d'une Fatal Error lorsqu'aucun exemplaire n'est transférable.

#60372 : Interrogation des sources externes
Tri alphabétique des catégories de sources tout en laissant les sources non catégorisées en dernière position.

#60427 : Indexation des nouveautés
Problème rencontré :
- Facette sur la nouveauté ne se mettant pas correctement à jour
Correction apportée :
- Mise à jour de l'indexation des notices n'étant plus considérées comme des nouveautés.

#61821 : [Z3950] Import exemplaires
Application de la "Localisation du document par défaut en création d'exemplaire" lorsque celle renseignée n'est pas connue. 

#62080 : Formats pris en charge du champ "year" pour le calcul du champ date_parution
La date de parution est calculée à partir du champ "Année" de la notice.
Les formats suivants sont désormais pris en compte :
=> 05-03-2018
=> 05.03.2018
=> 2018.03.05
=> 05\03\2018

#62092 : [PMB ISO-8859-1] Recherche multi-critères => Histo de recherche
Application du bon encodage à l'affichage des critères de la nouvelle interface de recherche multi-critères.

#62176 : Callback sur la sélection AJAX
Sélection AJAX de la collection, de l'éditeur et de la sous-collection.

#62412 : Message d'alerte bulletinage : Dépassés
Menu de gauche > Affichage de l'alerte "Abonnements dépassés" :
- Correction dans le calcul.

#62784 : Export de notices / URL de l'image en cache
Récupération de l'URL native de l'image.

#63156 : Tri complétion ajax des titres uniformes
Tri alphabétique complétion ajax des titres uniformes

#63656 : Bulletins : nouveautés
Prise en compte de la préférence utilisateur en bulletinage.

#63709 : [Retour prévu] Exemplaires en circulation
Liste des documents réservés :
Modification du libellé "En rayon" pour "En circulation" lorsque les exemplaires sont en circulation dans la colonne "Retour prévu".

#64438 : Encodage catégorisation automatique
Correction de l'encodage à l'affichage

#64672 : La date de création d'exemplaire ne change plus à l'update
La date de création d'exemplaire ne change plus à l'update dans la table exemplaires. C'était fait pour!

#65243 : Permalink de notice : Carrés de couleurs
Sur la fiche de la notice :
- Affichage des carrés de couleurs (associés au statut de la notice) sur les notices liées

#65704 : Facettes sur la RMC externe
Ajustement des facettes sur les recherches multi-critères externe.

-----------
Circulation
-----------

#59868 : [Transferts] Retour d'un exemplaire dans une autre localisation
Ne pas générer de transfert lorsque l'action par défaut lors d'un retour sur un autre site est sur l'option "Changer localisation exemplaire".

#59879 : Empêcher le retour de l'exemplaire sur un site autre que le sien
Cette option n'était pas correctement prise en compte dans certains cas.

#60553 : [Photos lecteurs] Cache des images
Suppression de l'image dans le cache lors de la modification d'une photo d'un lecteur.

#62029 : Encodage Ticket de prêt
Correction d'un problème d'encodage lors de la génération d'un ticket de prêt.

#62380 : RMC lecteurs - Titre de la recherche
Correction du libellé affiché.

#62676 : Passage du template de Ticket de prêt en CP437


------
Divers
------

#58809 : Dossier "images" dans les thèmes de gestion
Suppression du dossier "images" présent dans le dossier des thèmes de gestion et donc, en partie sélection des thèmes.

#58810 : Barre de progression
Ajustement de la hauteur de la barre de progression en partie gestion.

#58896 : Style Pure / Construction de page FRBR
Ré-affichage de la partie "construction de la page" dans le module: Portail > Pages FRBR > Construire la page

#59626 : Contribution : correction du datatype "marclist_selector"

#59898 : Correction d'erreurs notices
Correction d'erreurs notices

#60268 : Recherche incluant un terme "0"
Prise en compte du terme "0" s'il existe dans la recherche.

#60505 : Entête de fichiers rdf
Certains fichiers RDF n'avaient pas d'entête de version et étaient vus comme des fichiers binaires, c'est corrigé.

#60904 : [Facettes] Bouton "Filtrer" inactif
Erreur JS dans un contexte très spécifique :
"TypeError: document.getElementById(...) is null" lors d'un clic sur Filtrer

#61146 : Critère de recherche "numéro de bulletin"
Corrections sur le critère de recherche multi-critères.

#61856 : [Permalink de notice] Affichage de la collation
[espace]:[espace]
[espace];[espace]
[espace]+[espace]

#62046 : Evolution du style pure en partie Catalogue et DSI
Des améliorations ont été faites dans le style pure.
Dans la partie "Catalogue" :
- Modification de l'icône du panier dans les paniers en accès rapide
Dans la partie DSI :
- Correction des anomalies dans les veilles (sélecteurs non visible, bouton d'indexation mal placé ...)

#62233 : Ergonomie avec la nouvelle interface RMC
Ajustement de la taille du conteneur.

#63123 : RMC : Plusieurs critères + Opérateurs entre autorités
Le cas suivant ne fonctionnait pas :
- Sélections de plusieurs critères d'autorités
- Choix de plusieurs autorités par critère
- Choix de l'opérateur "ET" entre autorités
= Résultat de recherche incohérent

#63174 : [Documents numériques] Glisser/Déposer
Problème rencontré : 
Lors du glisser/déposer, les caractères accentués disparaissaient du nom de fichier.
Solution apportée :
- Conversion des caractères dans le bon encodage
- Remplacement des caractères diacritiques
Modules : Catalogue - Portfolio - Demandes de numérisations

#63695 : Valeurs de champs personnalisés
Insertion de valeurs 0 non voulues.

#63940 : [RMC] Numéro de bulletin
Correction de la requête de récupération des articles liés à la recherche sur le numéro de bulletin.

#64648 : [Géolocalisation] Fatal Error "map_holds_reducer"

#65011 : Prise en compte conversion avec export spécifique dans les services externes
Prise en compte du paramètre "specialexport="yes" dans la conversion par les services externes.

#65226 : [RMC] Prise en compte du format de date souhaité
Régression apparue à la mise en place des nouveaux champs de date (Dojo).

---
DSI
---

#58970 : [Bannettes] Groupement dans les bannettes
Amélioration sur l'ergonomie.

#58992 : Veilles : Sélection des tags existants
Mise à jour de la liste des tags existants lors de l'indexation d'un item.

#58994 : Modification d'un classement et affichage des veilles
Les veilles d'un classement étaient dupliquées dans l'arbre (non dupliquées en base de données) lors de la modification du classement.

#63715 : [Surveillance de sites web] HTTPS - Certificats
Modification de l'option cURL CURLOPT_SSL_VERIFYPEER pour outrepasser la certification SSL.

#63810 : [Bannettes] Groupement par facettes
Affichage des titres de groupements dans les mails.
Ils s'affichaient lorsque la case "Grouper" du produit document était cochée.

#64744 : [Veilles] Flux RSS : Double description
Gestion de la double description dans certains flux RSS.

#64936 : Détection de l'encodage dans les veilles sur un site Web
Dans certain cas l'encodage de la page html à traiter n'était pas correctement géré.

#65374 : Accès bannettes privées depuis la fiche lecteur
Le propriétaire de la bannette ne suivait plus lors de l'enregistrement en provenance de la fiche lecteur.

--------
Editions
--------

#61174 : Filtres qui sautent dans la liste des prêts
Les nouveaux filtres de catégories et de codes statistiques ne suivaient pas la pagination.

#61418 : Périodiques - Etat des collections
Affichage de la pagination.

------
Fiches
------

#59886 : Remplacement d'autorités utilisées en CP
Application de ces remplacements dans les valeurs de CP du module fiche.

#63631 : Utilisation de Dojo
Activation de Dojo dans le module.

----
OPAC
----

#58793 : Correction des sélecteurs multiples dans les formulaires de contribution
Les formulaires Dojo posaient des problèmes. On ne pouvait pas ré-afficher les valeurs sélectionnées lors d'une modification de contribution.

#58859 : RMC sélecteurs d'autorités personnalisées
Affichage de la liste.

#59171 : Données des oeuvres dont le titre uniforme est l'expression
Correction du calcul dans les affichages Django

#59596 : Contribution : filtre sur les sélecteur de ressources
Dans une contribution brouillon, si on a choisi plusieurs entités liées, on affiche qu'une seule fois le bouton "créer"

#59398 : Résolveur de lien OpenURL
L'enrichissement des notices avec le résolveur de lien OpenURL (Connecteur entrant) n'était plus fonctionnel.

#59761 : [A2Z + Aff Django] Enrichissements
Les onglets d'enrichissements ne s'affichaient pas dans le navigateur de périodiques avec l'utilisation des affichages Django de notices.

#59794 : Redirection de la connexion lecteur en accès direct
Ne pas tenir compte de la redirection souhaitée par le paramétrage en accès direct. 

#59806 : Recherche concept level1
Le comptage des résultats de concept prend en compte la $user_query

#59874 : Harmonisation/Déplacement du navigateur de bulletin

#59984 : Combiner les recherches cochées de l'historique
Le bouton "Combiner les recherches cochées" accessible à partir de l'historique des recherches lance la recherche

#60318 : Correction sur les contributions avec des entités ayant des guillemets dans leur libellé
Ajout d'un addslashes sur le display label

#60438 : recherche géographique
Lorsqu'on sélectionne une partie de la carte (grâce à l'outil de sélection), lorsqu'on clique dessus pour surligner la zone et que l'on clique sur "Rechercher", le résultat de recherche affiche la carte centrée sur la zone de recherche

#60561 : Page indexint_see
Le lien ./index.php?lvl=indexint_see affiche la liste des indexations  

#60710 : Transfert de notices en arabe dans un document pdf
Correction de l'affichage des notices en arabe une fois le document téléchargé.

#60745 : Recherche Sphinx sur le titre à l'OPAC
Correction d'une régression

#61011 : [Historique] Combinaison des recherches simples
Problème rencontré :
- on interroge sur d'abord sur abeille, puis on fait une 2ème question sur pollinisation.
- on visualise l'historique et on combine les deux questions précédentes par un ET
- on efface l'historique
- on interroge sur d'abord sur poisson, puis on fait une 2ème question sur écologie
- on visualise l'historique et on combine les deux questions précédentes par un ET
=> Les résultats étaient ceux de la première recherche combinée.
Correction sur le calcul de la signature avec la prise en compte des termes recherchés en combinaison multiple.

#61200 : Téléchargement des documents numériques dans l'OPAC
Prise en compte des droits sur les statuts de documents numériques.

#61291 : case "tous les champs" dans la recherche simple
On ne peut pas décocher la case "tous les champs" dans la recherche simple

#61770 : [RMC drag n drop] Pb champs auto-complétables

#61871 : Recherche de périodique dans le a2z
Optimisation de la recherche dans le navigateur de périodique a2z.

#61942 : [Géolocalisation] Affichage des notices liées
Application du template de notice défini dans le paramétrage en visualisation des notices liées à partir de la carte.

#62018 : [Etagère] Téléchargement des documents numériques dans l'OPAC
Téléchargement des documents numériques à partir d'une étagère.

#62088 : Pages FRBR: Correction de l'encodage des templates

#62123 : [Ré-initialisation des facettes] Navigation dans les localisations / sections
Ré-initialisation des facettes au changement de section.

#62411 : Picto de la licence dans la visionneuse
Le picto ne s'affichait plus.

#62864 : Corrections à la création d'une alerte privée
Corrections à la création d'une alerte privée :
- Afficher le nombre de résultats dans le mail
- Prise en compte du template déclaré dans le paramètre DSI > private_bannette_tpl
- Ajustement des dates de dernier envoi + remplissage

#62871 : Lien "Voir les critères de recherche de l'alerte"
Ne pas remonter en haut de la page lorsque l'on clique dessus pour afficher l'équation.

#63217 : Pb avec la variable django {{record.availability.availability}}
Problème rencontré :
- Une notice avec 2 exemplaires dont un en prêt et l'autre en résa validée
Le message indiqué était "Disponible" au lieu de "De retour le".

#63720 : Suggestions de recherche : Caractères numériques
- Conservation des caractères numériques dans la liste auto-complétée.

#63786 : [Bannettes] Affichage du nombre de notices envoyées
Correction sur l'affichage.

#63789 : Correction vulnérabilités de type XSS
Exemple d'injection:
/print.php?lvl=search&current_search=0'><img src=x onerror=prompt(1)>

#64200 : [Lenteurs] Affichage d'un bulletin

#64349 : Surlignage résultat de recherche
Prise en compte du div id='resultatrech' et id='resultatrech_liste'

#64444 : [Listes de lecture] Encodage des notifications
Correction sur l'encodage des codes messages suivants :
<pre>
list_lecture_name_dont_filled
list_lecture_name_exists
list_lecture_confirm_suppr
list_lecture_already_requested
list_lecture_confirm_delete
</pre>

#65235 : Conversion externes des relations associées
Correction de la "fatal error" soulevée par la version PHP 5.6+.

-------
Portail
-------

#61993 : [auto-complétion] Elimination du double parse 
Arrivée à la suite des grilles éditoriales.

#62043 : Réajustement de la taille du conteneur
Dans la rédaction du contenu éditorial, on ajuste la taille de la fenêtre pour éviter si possible le scroll Y 

#62045 : Placement des complétions ajax
Placement des complétions ajax si présence de scroll (édition éditorial)

#65472 : Style ZEN | Modification bouton recherche avancée
Suppression du background du bouton de recherche avancée en double.

#65650 : Traduction du contenu éditorial | Gestion de la langue par défaut de l'OPAC
La langue par défaut de l'OPAC est maintenant gérée pour la traduction du contenu éditorial.
Les champs par défaut du contenu éditorial doivent donc être remplis dans la langue par défaut de l'OPAC (opac_default_lang).


*******************
EVOLUTIONS


------------
Acquisitions
------------

#62004 : SUGGESTIONS : export du champ ORIGINE
Ajout de l'origine de la suggestion dans l'export tableau.

#64372 : Fonction d'import dans les suggestions
Acquisitions > Importer des suggestions
- "MARC ISO2709" renommé en "UNIMARC ISO2709"
- "UNIMARC ISO2709" sélectionnée par défaut

--------------
Administration
--------------

#61487 : Ergonomie dans les templates de mails
Harmonisation des boutons en modification d'un template de mail.

#62658 : Factorisation du code source de la gestion des imports
Réduction de code pour simplifier les futurs développements + personnalisations.

#62713 : Import de notices : pouvoir conserver la notice de l'import en cas de doublon
Nouvelle option :
 - En cas de doublon sur ISBN, remplacer la notice existante par la notice du fichier d'import

#62805 : Calendrier : Distinction des dates fermées et non définies
- Ajout d'un bouton pour "Réinitialiser" entre deux dates

#62873 : Sélecteur de date en synchronisation de source externe
Mise en place du calendrier Dojo.

#63741 : Création d'une nouvelle fonction d'import cvs
Création d'une nouvelle fonction d'import cvs.
910$u pour lien url et 910$t pour nom du document numérique

#65016 : Authentification avec un utilisateur externe dans le connecteur sortant d'automate de prêt
Ajout d'un identifiant et mot de passe pour l'authentification avec un utilisateur externe dans le connecteur sortant d'automate de prêt

#65240 : Encodage en conversion/import
Modification du code de PMB pour passer par les fonctions PMB de misc pour la gestion de la conversion iso <-> utf-8.

#65527 : Réabonnement en ligne | Page de paramétrage du formulaire
Page de paramétrage du formulaire de réabonnement pour afficher / rendre obligatoire / modifiable / expliquer les champs de l'emprunteur.

#65587 : Réabonnement en ligne | Gestion des champs persos de lecteurs et champs obligatoires
Gestions des champs persos de lecteurs et des champs obligatoire dans l'administration du formulaire de réabonnement.

---------
Autorités
---------

#59517 : Dédoublonnage des auteurs et éditeurs
Dédoublonnage des auteurs et éditeurs en tenant compte de l'accentuation
Sur paramètre pmb_controle_doublons_diacrit

#62516 : Ajout des vignettes d?autorités dans le common
Ajout des vignettes d'autorités dans les templates common

#63509 : Ajout complétion ajax dans les catégories
Ajout complétion ajax dans les catégories:
Catégorie Parente
Renvoi voir
Renvois voir aussi

---------
Catalogue
---------

#59115 : Messages d'en-têtes de colonnes des champs exemplaires
Ajout des messages suivants dans les fichiers natifs :
- Message exemplaire
- Commentaire non bloquant
- Prix
Il n'est plus nécessaire de créer un fichier subst pour ces messages.

#59777 : Affichage des catégories liées à une entité
Augmentation de la taille du champ de saisie autocomplétable.

#59903 : Evenement à la modification d'une notice
Ajout d'un événement à la fin de la modification d'une notice pour y brancher d'éventuels plugins.

#60605 : Carte, recherche dans un rayon à partir d'un point 
Carte, recherche dans un rayon de 'x' km à partir d'un point

#61767 : [Recherche paniers] Suppression + Pointage
Ajout de la suppression et du pointage à la volée dans la recherche par panier.

#62086 : Nouvelle option utilisateur : Bulletinage OPAC
"Activer par défaut l'option du bulletinage en OPAC en création de périodique ?" (case à cocher activée par défaut)

#62480 : Indexation des Concepts
Ajout en standard de l'indexation des altlabels et hiddenlabels des concepts sur l'indexation des notices

#64638 : Colonne 'Nombre de prêts' dans le tableau d'exemplaires sous une notice
Ajout de la valeur "nb_prets" dans le commentaire du paramètre "expl_data" afin de pouvoir ajouter la colonne "Nombre de prêts" dans les tableaux d'exemplaires.

#65147 : Unimarc zone 219, report en V5
Prise en compte de la zone 219 dans les imports, Z39.50, et affichage unimarc (informations de l'éditeur).

#65760 : [RMC] Identifiant de la notice
Nouveau critère dans la recherche multi-critères :
- Identifiant de la notice

-----------
Circulation
-----------

#60467 : Espace avant/après le code-barres lors du prêt/retour
Élimination des espaces en début et fin de chaîne de caractères en prêt ou retour de document.

#60996 : Optimisation prolongation des prêts
Modification d'une requete utilisée à chaque prolongation de prêt pour diminuer le temps de traitement.

#61000 :  Piège paramétrable sur monopole de prêt
Évolution du paramètre loan_trust_management pour avoir la possibilité d'afficher l'information sous forme d'un message non bloquant.
0: Non
x: nombre de jours entre 2 prêts d'un exemplaire d'une même notice (ou bulletin)
x,1: Affiche l'information sous forme d'un message non bloquant

#62408 : Limitation de l'affichage des prêts et prolongation en lot
Une alerte sera désormais jouée pour afficher tous les prêts lorsque l'on clique sur le bouton "+" en en-tête de liste.

#62702 : HTTPS / imprimantes à tickets de prêts
Prise en compte de l'HTTPS pour l'interfaçage avec les imprimantes à tickets de prêts.

#63068 : Quotas de prêts sur des champs de notice
Ex : Quota de prêt sur le champ de "Nouveautés".

#64225 : Date de parution du périodique dans le mail de relance
Ajout de cette information dans le mail de relance.

#65429 : RMC Lecteurs - Ajout  critère de fin d'adhésion
Nombre de jours par rapport à la fin d'adhésion

#65445 : Template de mail | Ajout d'informations emprunteur
Dans les templates de mail, ajout des informations :
- nombre de jours restant avant fin d'abonnement
- lien de réabonnement

------
Divers
------

#58808 : Zone alerte partie gestion
Valorisation des alertes en partie gestion

#58813 : Pictogramme [+] en partie gestion
Grossissement du pictogramme [+] en partie gestion

#59814 : Ajout de la date de parution dans l'index d'une notice
Ajout du champ date_parution dans le champs_base.xml

#60394 : Identifiant du cadre dans les pages FRBR

#62051 : Evolution dans l'affichage des raccourcis
Modifications pour que les raccourcis soient visibles sans scroll Y dans tous les styles.

#62473 : Ajout évènement before_update sur documents numériques
Ajout d'un évènement before_update sur les documents numériques pour mise à jour dans le plugin Alfresco.

#62486 : export emprises de carte des notices
export emprises de carte des notices dans les services externes

#64184 : Variable django : contributeur
Nouvelle variable django "contributor" pour récupérer les informations du lecteur ayant contribué
exemple :
<pre>
{{ record.contributor.nom }} {{ record.contributor.prenom }}
</pre>

#64730 : [Paniers] Procédures d'actions
Il y a désormais la possibilité de revenir rapidement aux procédures d'actions depuis la page résultant d'une procédure d'action.

#65698 : Gestion des mails en erreur
Modification des envois de mail dans PMB pour que, lorsque le paramètre mail_adresse_from est renseigné, les réponses automatiques des serveurs destinataires répondent à l'adresse d'expédition et non à l'adresse du paramètre mail_adresse_from
Attention, ces messages d'erreur de non transmission peuvent être considérés comme des SPAM.

---
DSI
---

#62785 : Flux RSS DSI
Onglet DSI > Flux RSS > définitions
=> Le lien du flux RSS est désormais cliquable.

#63758 : [Flux RSS] Pagination
Mise en place du paginateur avancé.

#64473 : Bouton "retour" en visualisation du contenu d'une bannette
Ajout d'un bouton "retour" en visualisation du contenu d'une bannette.

--------
Editions
--------

#58997 : [Etats paramétrables] Documents numériques
Ajout de la source de données "Documents numériques" dans les états paramétrables.

#61214 : Pagination dans les listes de lecteurs
Ajout de la pagination avancée dans les listes de lecteurs.

#62793 : Fonction de template : #categories
Ajout d'un 6ème argument pour limiter la liste des descripteurs.

#63658 : [Template de notices] Fonction #statut
Prise en compte du contexte "Gestion" ou "OPAC" pour l'affichage du libellé.

#64677 : Ajout du type de document dans les mails de retards
Information sur le type de document ajoutée dans les mails de retard.

----
OPAC
----

#58785 : Formulaire de contact
Valorisation de l'affichage du message d'erreur lorsqu'un utilisateur ne remplit pas correctement le formulaire de contact.

#58892 : Ajout de tous les auteurs dans les coins Zotéro
Ajout de la variable GET "rft.aut" (concaténer) pour chaque auteur de la notice.

#58952 : Trombone documents numériques sur notice liée
Affichage de l'indicateur de documents numériques sur les notices liées

#59261 : Prêts en cours/en retard
- Affichage du titre de série devant le titre de la notice.

#59618 : Ajout d'un title sur le lien "Visionner les documents numériques" de la recherche

#59811 : Message de désinscription à une liste de circulation de périodique
Affichage d'un message de confirmation : "Votre demande a été bien enregistrée.".

#60211 : Correction d'erreurs "notice" dans les contributions

#60257 : Suppression de l'infobulle sur les grilles de formulaires de contribution

#60267 : [Django] Variable globale "today"

#60517 : Variable django pour identifier les notices Cairn.info
Nouvelle condition pour identifier les notices Cairn.info :
{% if record.cairn_source %}
...
{% endif %}

#61055 : Formulaires de contribution | Ergonomie des sélecteurs de ressources
L'autocomplétion sur les sélecteurs de ressources dans les contributions est revue.

#61201 : Impression d'un résultat de recherche
Bouton "Imprimer" renommé en "Valider".

#61872 : Paginateur d'étagères et autres
Les variables d'environnement transmises en GET sont désormais récupérées par le paginateur.

#61952 : Contribution : augmenter le nombre de caractère maximum des champs de saisie "small text"

#62202 : Visualisation du contenu de mes alertes
Séparation des bannettes publiques et des bannettes privées.

#62783 : Compte lecteur en OPAC : afficher le nombre de prêts
Nombre de prêts affichés entre parenthèses.

#64380 : Séparateur pour l'arborescence d'une catégorie
Prise en compte du paramètre OPAC :
- categories_categ_path_sep

#64640 : Stats sur les URL externes
Modification de l'événement pour que le "clic + molette" soit pris en compte dans les visites de sites externes.

#64780 : Template sur flux rss de recherche
Pouvoir associer un template aux flux RSS des recherches en OPAC.
Nouveau paramètre OPAC : short_url_rss_records_format

#65768 : Traduction en anglais des nouveaux messages à l'OPAC
Traduction des nouveaux libellés à l'OPAC et correction de quelques anciennes traductions.

-------
Portail
-------

#59642 : Vider la barre de saisie de recherche après en avoir effectué une
Variable "nofill" placé dans l'url pour permettre de vider la barre de saisie de recherche après en avoir effectué une est remplacé par le paramètre cms_search_view_nofill

#60625 : Tri par pertinence dans les rubriques et les articles
Articles/Rubriques dont la source de données est "issue des catégories d'un(e) article/rubrique".
Pertinence calculée sur le nombre de catégories en commun.

#62027 : Vider le cache des images
Opération supplémentaire nécessaire :
=> Le cache du portail sera désormais vidé au nettoyage du cache des images




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.6                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


------------
Acquisitions
------------

#49986 : Création d'une commande à partir de multiples suggestions
Correction du tableau résumant les suggestions dans la commande.

--------------
Administration
--------------

#49734 : Paramétrage de la visionneuse
Les paramètres par défaut ne s'affichaient plus sans avoir enregistré.

#50034 : Encodage dans la bibliothèque de fonctions json-rpc de PMB
L'encodage de la requête en json-RPC n'était pas géré correctement dans la classe pmb_jsonrpc_client de PMB contrairement à la classe jsonRPCClient

#50250 : Connecteur Web Services PMB
Correction de l'enregistrement du paramétrage de l'authentification.

#50564 : Synchronisation et import automatique via le gestionnaire de tâches
Correction sur la prise en compte des dates de synchronisation.

#50634 : [Webservices JSONRPC PMB] Encodage UTF-8 sur les statuts de notices
La récupération des statuts de notices accentués via JSONRPC générait une erreur.

#50904 : Possibilité de modifier le paramètre de fonction d'import z3950 dans le cas où elle n'existe pas
Le message d'erreur "La fonction d'import z3950 "*.inc.php" n'existe pas" s'affichait en boucle lorsque la fonction n'existait pas.
Le clic sur le bouton "OK" renvoie maintenant vers le paramètre à modifier.

#51829 : Formulaires de contribution | Valeur par défaut dans les sélecteurs de ressources
Correction d'une anomalie lors du réenregistrement d'un formulaire dont des sélecteurs de ressources sont renseignés par défaut.

#51836 : Formulaires de contribution en gestion
Possibilité de vider un champ "ressource_selector" dans les formulaires de contribution en gestion

#52132 : Modification import ASCODOCPSY
Modification de la fonction d'import ascodocpsy pour changer la condition de création de nouvelles catégories.
Ajout d'un test à la conversion du format ascodocpsy pour les catégories du thesaurus THEMES.

#52893 : Conversion PMB vers Prisme
La conversion est de nouveau fonctionnelle.

#52908 : Liens entre notices
Choix des liens à conserver en import et remplacement de notices.
Modification des libellés.

#53155 : Actions personnalisables : Sous-requêtes
Le retour à la ligne dans la requête SQL pour les listes de choix à partir d'une requête SQL posait problème.

#53493 : Option de ré-indexation "Générer les liens entre les descripteurs nécessaires à l'autopostage"
Parcours des catégories par "passe" pour éviter de dépasser la durée de traitement autorisée par le serveur.

#53861 : Statistiques OPAC
Récupération des messages de l'OPAC pour la consolidation de certaines stats.

#53961 : [Gestionnaire de tâches] Actions personnalisables
Correction sur le ré-affichage des paramètres de type "Liste de choix".

#54012 : Barre de chargement nettoyage de base
Ré-ajustement de la taille en fonction du pourcentage.

#56166 : Planificateur de tâches - Impression
Modification de la police de caractères en sortie.

#56267 : Connecteur OAI sortant : inf ou égal à 1970-01-01
L'interrogation "?verb=ListRecords&metadataPrefix=oai_dc&from=1970-01-01" ne renvoyait aucune notice.
Seules les dates strictement supérieure "1970-01-01" fonctionnait (date Unix la plus ancienne).

#56378 : Import lecteur : fatal error si on ne sélectionne pas de fichier
Correction d'une fatal error en import lecteur lorsque aucun fichier n'est sélectionné.

#56411 : Connecteurs : Action "Vider"
Suppression des lignes dans la table SQL "external_count" lors de l'opération de vidage.
Attention à l'utilisation de l'option "Suppression automatique des notices supprimées du serveur" au travers de la synchronisation par le planificateur de tâches.
Avec cette option, les notices cataloguées via l'import depuis un entrepôt seront supprimées si elles n'apparaissent plus dans l'entrepôt PMB.

#56566 : Préférences / acquisitions : adresses de facturation et livraison par défaut
Cela n'était plus affiché dans les préférences.

#56700 : Imports lecteurs : Localisation
Correction sur l'attribution de la localisation.

#56813 : Synchronisation via le planificateur des tâches
Dans les tâches de synchronisation externe ne prendre en compte la date de synchronisation qui est enregistrée dans les paramètres de la tâche que:
- lorsque l'on est avec l'option "Vider l'entrepôt avant de démarrer la synchronisation" de cochée
- en mode "Depuis la dernière synchronisation"
- la tâche a déjà eu lieu au moins une fois
- il y a au moins une notice dans l'entrepôt.
Sinon c'est la date de la notice la plus récente de l'entrepôt qui fait office de date de départ sauf en mode "Entre le"

#57063 : [Gestion des images] Suppression d'une image dont le libellé contient le caractère '
Correction pour permettre la suppression des images dont le libellé contient le caractère '.

#57801 : Affichage d'un utilisateur avec une apostrophe
Un utilisateur avec une apostrophe dans son nom ou son prénom n'était pas correctement affiché en modification.

#58449 : Messages de contributions manquants
Certains messages présents en français uniquement.

#50655 : [Webservices] Authentification JSONRPC
Correction sur l'authentification vers un autre PMB via JSONRPC.

---------
Autorités
---------

#50121 : Indexation des libellés de catégories traduits
La recherche sur un terme de catégorie ne ressortait pas en recherche

#50438 : Autopostage des concepts
Correction des requêtes de recherches et modification de l'indexation.

#50791 : RMC Autorités | Critère de schéma de concept
Correction du critère de schéma de concept dans la RMC autorité. La sélection via le popup fonctionne à nouveau.

#50872 : Indexation du libellé alternatif des concepts
Le libellé alternatif des concepts est maintenant correctement indexé pour ressortir dans la recherche tous les champs des concepts.

#51223 : [RMC - Champs personnalisés] Opérateur "Est vide"
L'opérateur "Est vide" sur les champs personnalisés d'autorités n'était pas fonctionnel.

#51329 : Authorities_collection et la classe catégories
Il manquait un cas de figure pour récupérer proprement une instance de catégories depuis authorithies_collection 

#52249 : Ajout de l'identifiant du schéma dans l'indexation d'un concept
Dorénavant, on peut chercher les concepts via leur schéma en "sélection d'autorité".

#52267 : Navigation hiérarchique dans les concepts
Correction de la navigation hiérarchique dans les concepts et de la gestion de la case à cocher "Seulement les autorités racines"

#52288 : Ajout de concepts à un concept composé
Correction du libellé dans la grille de saisie du concept composé si l'on ajoute un concept sans schéma.

#52378 : Autopostage des concepts : Amélioration de l'indexation

#53577 : Grille de saisie des autorités perso
En édition d'autorité perso à partir de la fiche de l'autorité, la grille est bien prise en compte

#53583 : Affichage de l'autorité perso dans le sélecteur après création
Affichage de l'autorité perso dans le sélecteur après création à partir d'une notice.

#54210 : Correction de l'autocompletion des concepts quand sphinx est activé
L'autocomplétion des concepts ne fonctionnait pas lorsque sphinx était activé et que l'on cherchait "*".

#54243 : Prise en compte du type d'autorité personnalisée dans les sélecteurs popup
Le type d'autorité personnalisée n'était pas pris en compte lors de la recherche au travers des popup.

#54933 : Vignettes des auteurs
Re-prise en compte de vigurl

#55151 : Remplacement d'autorité
Dans le cas du remplacement d'une autorité par une autre, il manquait le remplacement pour certaines valeurs de champ perso :
CP d?emprunteur
CP de concept
CP d'état des collections
CP de demande
CP d'exemplaire
CP de documents numérique
CP de pret
Il manque encore la gestion des CP du module Fiche

#55181 : Concepts | Prise en compte du statut dans la liste hiérarchique
Prise en compte du statut d'autorité dans la vue hiérarchique des concepts.
Ajout du statut de l'autorité dans le store RDF.

#56409 : Dictionnaire des synonymes : Pagination
La lettre sélectionnée ne suivait pas lors du passage aux pages suivantes.

#56920 : Détails d'une catégorie
Remplacement du libellé "Commentaire" par "Note d'application".

#57057 : Recherche autorités et création de thésaurus
Lors de la création d'un thésaurus le n?ud racine qui n'a pas de libellé était indexé et cela posait un souci d'affichage.

#57677 : Ajout de la composition dans la duplication d'un concept
Lors de la duplication d'un concept composé, la composition est bien reprise.

#57836 : Correction d'erreurs "notice" dans le framework des concepts

#57840 : Conservation des liens entre autorités lors du remplacement d'un concept

#58276 : Suppression de concept | Réindexation des concepts liés
Les concepts liés à un concept que l'on supprime sont maintenant correctement ré-indéxés.

---------
Catalogue
---------

#48964 : Prise en compte du paramètre utilisateur "Localisation par défaut en visualisation du bulletinage" dans la liste des bulletins d'un pério
Dans la fiche d'un périodique en gestion, pour l'affichage des bulletins, on prend maintenant en compte le paramètre utilisateur  "Localisation par défaut en visualisation du bulletinage"  plutôt que "Localisation par défaut en visualisation d'un état des collections".

#49374 : Suppression de dépouillement
Lors de la suppression d'un dépouillement, l'indexation Sphinx et le stockage des concepts n'était pas supprimé correctement.
On fait maintenant appel à la méthode de suppression d'une notice, plus complète.

#49498 : Lien entre panier et bannettes
Changement de l'affichage des liens avec les bannettes dans l'édition d'un panier.

#49748 : Autocomplétion de concepts dans les formulaires de notices
L?auto-complétion des concepts dans les formulaires de notices est de nouveau fonctionnel en V5_0.

#49811 : Régression sur la sélection d'autorités perso
Correction d'une régression sur la sélection des autorités perso entre la 5.0.4 et la 5.0.5.

#49910 : Recherche Sphinx en gestion
Correction de la recherche sphinx sur les notices en gestion.

#50117 : Titre de la recherche externe
Correction sur le titre en recherche externe. Ajout d'un lien en mode avancé pour retourner au mode simple.

#50487 : RMC sur les notes
Conservation des mots vides sur les opérateurs suivants dans les notes (note de contenu - note générale - résumé) :
- Commence par
- Finit par
- Exactement comme

#50491 : Code de message pour les Catégories en création/modification de notice
Modification pour différencier le message "Catégories" en création/modification de notice et celui en recherche d'autorités.

#50578 : Impression de résultat / envoi par mail
Prise en compte de la modification de l'objet.

#50605 : Recherche dans les documents numériques en gestion
La recherche Tous les champs de gestion comportait une erreur sur la recherche au sein des documents numériques.
Elle était limitée aux notices dont les documents numériques sont visibles à l'OPAC par le statut.

#51047 : Autocréation de nom de document numérique
Correction de la création automatique du nom d'un document numérique si rien n'est renseigné à l'ajout.

#51111 : Indexation des documents numériques  doc, docx, ...
L'indexation plein texte des documents numériques avec le paramètre jodconverter_cmd n'était plus fonctionnelle depuis le passage à Php 5.6 à cause d'une évolution de php_curl pour le POST de fichier.

#51237 : [Documents numériques] Droits sur les vignettes
La vignette du document numérique rattachée à un bulletin ne s'affichait pas lorsque son périodique n'était pas visible à l'OPAC alors que sa notice de bulletin est bien visible.

#51315 : [Documents numériques] Upload en base
Erreur de sélection du bouton "radio" sur "Uploader vers" lorsque le document est enregistré en base.

#51327 : Indexation - champ avec une pondération à 0
Dans le moteur, on trouve des champs indexés avec un pondération à 0.
C'est logique dans les tables <entité>_fields_global_index, cela permet de construire les facettes.
Par contre, aucun intérêt de les stocker dans <entité>_words_global_index qui ne sert que pour la recherche booléenne.

#52277 : Calcul de la vignette d'un document numérique
Augmentation du timeout cURL à 10 pour la génération de la vignette calculée à partir d'un document numérique.

#52734 : Résultats de recherche - Réservation sur les bulletins
Affichage du bouton de réservation dans la notice de bulletin si le paramétrage le permet.

#52780 : Prévision(s) visibles dans les résultats de recherche
Ne pas faire apparaître le libellé "Prévision(s)" lorsque cela n'est pas utile.

#53498 : Vignettes de document numérique
Ajout d'un fond blanc dans la génération des vignettes de document numérique 

#53559 : Gestion des droits de création d'autorités personnalisées dans le sélecteur
Gestion des droits de création d'autorités personnalisées dans le sélecteur en edition de notice

#53606 : Vignettes des documents numériques
Correction du remplacement de la vignette enregistrée par une nouvelle.

#54453 : Correction édition des documents numérique en popup
La suppression d'un document numérique via la popup d'édition ne ramenait pas sur la notice. C'est maintenant corrigé.

#55205 : récupération des attributs dans l'oai
Dans la récupération d'une notice, on récupère maintenant les attributs du tag metadata.

#55206 : Récupération des champs note générale et résumé en répétables en z3950
Dans la récupération des notes en z3950 seule la note de contenu était traitée comme un champ répétable.
On modifie la reprise de la note générale et du résumé pour prendre en compte la répétabilité du champ.

#55416 : Impression des fiches catalographiques
De nouveau compatible avec les nouvelles versions de PHP.

#55463 : Interrogation externe simple sans sources sélectionnées
Le chargement de la page ne se passait pas correctement.

#56475 : Gestion des avis
Le bouton Notices est désormais sélectionné par défaut.

#56543 : Problème de prise en compte du paramétrage PHP dans les documents numériques
Correction de la prise en compte du memory limit dans la classe explnum. (La valeur peut être à -1, ça n'était pas pris en compte)

#56668 : Articles de périodiques externes : Intégration dans la base
Correction de l'intégration des articles n'étant pas rattachés à un périodique via la recherche externe.

#56808 : Import de fichiers Word et Excel avec le connecteur Zotero
Récupération du mime-type en intégration de notices.

#57076 : Recherche Auteur/Titre : Pagination liste d'auteurs
Rétablissement de la cohérence dans la pagination.

#57123 : Recherche Auteur/Titre : Tri liste d'auteurs
Ré-application du tri alphabétique.

#57184 : Dédoublonnage en import d'articles
Désormais, les articles seront rattachés au bulletin le plus récent s'il existe plusieurs numéros identiques sous le même périodique.

#57247 : Connecteurs entrants PMB : Doublons
Correction sur le dédoublonnage.

#57352 : [Recherche paniers] Application du tri
Correction sur l'application du tri.

#57370 : Import z39.50 Sudoc
Lors de la déclaration du serveur z39.50 du SUDOC il faut utiliser le port 10646. Cela permet d'obtenir toutes les notices en utf-8 comme c'est indiqué dans le champ 100$a de chacune des notices.
Avec un PMB en Iso, pour ne pas avoir de soucis d'affichage il faut également avoir installé l'extension php: php-intl.

#58063 : Affichage nombre de prêts d'un exemplaire
Bug d'affichage corrigé.

#58072 : Imports/Exports de documents numériques
Récupération conforme de l'URL du document numérique.

#58083 : RMC Catalogue / Sphinx : Recherche titre qui cherche également dans les documents numériques
La recherche titre attaquait également les index de documents numériques avec Sphinx.
Le correctif était déjà appliqué en DEV, il s'agit d'un report en 5.0

#58349 : Listes de notices d'une autorité : Tris
Correction sur l'application du tri.

#50249 : Sélecteur de catégories : Recherche dans plusieurs langues
La recherche dans plusieurs langues de nouveau fonctionnelle.

#52154 : [Abonnements de périodiques] Affichage du calendrier
L'affichage du calendrier n'était pas affiché en totalité dans certaines situations.

#53288 : Génération de codes-barres
Optimisation du script "gen_code/gen_code_exemplaire.php"

-----------
Circulation
-----------

#49859 : [Réservations] Conservation de la localisation par défaut
Conservation de la localisation par défaut lors de la validation de la réservation ou du choix de l'exemplaire.

#50772 : Voir la notice d'une demande de numérisation
Correction du bouton 'Voir la notice' d'une demande de numérisation pour pouvoir consulter articles et periodiques.

#51630 : Condition d'affichage de l'historique de relance
Changement des conditions d'affichage et de nettoyage de l'historique des relances.

#51680 : Numéro du lecteur
Nettoyage du numéro de lecteur à la sauvegarde.
Non autorisation des guillemets + apostrophes. 

#52529 : Lien vers la notice d'une demande de numérisation
Correction dans la création du lien d'une demande de numérisation

#54150 : [Prêts] Confirmation au retour
Le paramètre confirm_retour n'était plus pris en compte.

#57025 : Recherche avancée de lecteurs par sexe
Ajout de la valeur "Non précisé".

#57832 : Alerte sonore au retour des documents
Ajustement des alertes sonores jouées.

#57910 : Différence table pret/pret_archive pour les prolongations
Mise à jour du champ de prolongation de la table pret_archive appliquée lors de la prolongation.

#51753 : [Fiche lecteur] Affichage du type d'abonnement
Correction du problème d'encapsulation dans le DOM HTML.

--------
Demandes
--------

#54448 : Tri des questions de la FAQ
Ajout d'un critère de tri supplémentaire pour l'affichage de la FAQ à l'OPAC.

------
Divers
------

#49284 : Gestion des procédures de paniers : Forçage
Certaines procédures indiquent une erreur de jointure lors de leurs exécutions.
Nous pouvons désormais "forcer" l'exécution d'une procédure si le paramètre "procs_force_execution" est activé.

#49581 : RMC : Relations horizontales
On s'appuie désormais sur le fichier "relationtypeup" pour l'affichage et les résultats du critère "Relation horizontale associée".

#49608 : Gestion des mots non vides
Prise en compte des mots non vides en indexation et en recherche PMB.

#50486 : Drag n drop sur les champs personnalisés
Cela n'était pas fonctionnel lorsque parmi les champs personnalisés aucun n'était autre qu'un champ liste à partir d'une requête SQL.

#50648 : [Collectes] Bloc rendu invisible
Le bloc "Choisissez les éléments sur lesquels portera la requête" apparaissait en collecte par procédure de sélection

#50738 : [Pop-up de sélection] ISBD des sous-collections
Correction sur le formatage des ISBD de sous-collections dans les pop-up de sélection.

#50857 : Cache des images
Lorsqu'aucune image n'était trouvée le cache ne gérait pas correctement le fait que l'image "vide" puisse être différente en gestion et en Opac mais également entre différents PMB partageant le même cache sur le serveur.

#51261 : Variable serveur PHP_SELF
Suppression de son utilisation dans PMB.
Elle pose problème dans certains contextes.

#51355 : Optimisation dans strip_empty_words
Optimisation de la méthode de nettoyage des mots vides.
On transforme un parcours de boucle avec un preg_replace par mot à un preg_replace global qui fait le même travail.

#51369 : Relations entres notices
Récupération du niveau bibliographique et du niveau hiérarchique des notices liées pour un meilleur formatage.

#51736 : [RMC Catalogue & OPAC] Critère de catégories
Prise en compte du thésaurus sélectionné en recherche multicritère pour un choix "Est vide" ou "N'est pas vide".

#52569 : Pointage dans un panier
Le pointage sur plusieurs éléments en quasi-simultanée pouvait amener un problème d'affichage.
La modification de l'image se faisait uniquement sur la dernière.

#53051 : Correction d'une erreur "notice" dans les plugins

#53073 : RMC sur le titre
Modification de la recherche sur le critère "Titre" pour les opérateurs suivants :
- Commence par
- Finit par
- Exactement comme
On se base désormais sur le champ "tit1" de la table "notices" en lieu et place du champ "index_sew".

#53115 : Classe de recherche Sphinx: liste des critères
La récupération des critères disponibles ne fonctionnait pas pour le cas un peu particulier des concepts

#53418 : Redimensionnement des vignettes en impression de panier 
Intégration de la classe CSS pour le redimensionnement des vignettes.

#53678 : Prise en compte du paramètre d'indexation par défaut à la création d'un document numérique depuis un fichier temporaire
Prise en compte du paramètre d'indexation par défaut à la création d'un document numérique depuis un fichier temporaire

#54392 : Correction addslashes manquant dans l'utilisation des cookies
Les informations contenues dans les cookies étaient utilisées telles quelles dans les requêtes sans addslashes. 

#54487 : Correction dans l'affichage d'un champ personnalisé
Ajout d'une vérification pour éviter de chercher un champ personnalisé qui a été effacé,retournant une erreur, comme dans une équation de recherche par exemple.

#54494 : Gestion des procédures de paniers : Suppression
Il n'était pas possible de supprimer des procédures contenant des guillemets.

#55164 : Correction acces proxy pour serveur de procédures distantes
Problème d'accès depuis passage du serveur de procédures distantes en https.
Ajout d'options afin d'éviter la vérification du certificat si utilisation d'un proxy.

#55256 : ARC2 | Require manquant
Ajout d'un require dans le store ARC2.

#56474 : Lien de téléchargement de la documentation
Mise à jour du lien de téléchargement de la documentation.

#56676 : Vérification des liens dans PMB - Curl
Lors de la vérification d'un lien saisi dans un champ de PMB, on considère maintenant le lien valide dès que celui-ci renvoie un code de statut HTML 2XX ou 3XX. 
Avant seul le statut 200 était considéré comme valide.

#56793 : Correction sélecteur autorité perso en RMC
La sélection d'une autorité perso était KO en RMC

#57668 : [RMC] Droits d'accès utilisateur au module 
Un utilisateur n'ayant pas accès à l'onglet catalogue ne pouvait pas effectuer de recherches multi-critères lecteurs et autorités.

#57862 : Fréquentation d'apparition des mots : Calcul de pertinence
Correction sur le calcul de pertinence avec l'utilisation de '*' en recherche.
Anomalie rencontrée lorsque le paramètre "search_relevant_with_frequency" est activé.

#57945 : Recherche booléenne tous les champs avec Sphinx
Le report de la recherche booléenne Sphinx n'avait pas été fait partout.

#58115 : Nettoyage des constantes d'entités
Nettoyage des constates nécessaire pour des corrections concernant les vedettes composées.

#58119 : [Champs personnalisés] Valeur 0
La valeur 0 dans un champ personnalisé n'est plus considérée comme une valeur vide.

#58233 : [Sphinx] Critère Contenu du document numérique
Ce critère ne prenait pas en compte l'activation de Sphinx.
C'est fait !

#51011 : Prise en compte des codes langue oai_dc en majuscules.
Les codes langues en majuscules n'étaient pas pris en compte lors de l'import depuis une source oai_dc.
Modification de la feuille de style afin de les transformer en minuscules.

#55868 : Affichage des champs persos de type liste 
Correction sur l'affichage des champs persos de type liste lorsque aucune valeur n'est associée

---
DSI
---

#49409 : Pagination dans le menu "Diffuser"
Correction sur le parcours des bannettes sur le menu "Diffuser"

#49674 : [Veilles] Récupération des notices d'un entrepôt
Correction de l'erreur d'identification de notice. Nous pouvons désormais créer la notice via l'item de veille.

#51558 : Veille : récupération des catégories d'articles et de rubriques
Correction de la récupération des catégories d'articles et de rubriques dans les veilles

#56598 : Mention du nombre de notices envoyées mal positionnée
Correction de l'affichage du nombre de notices dans le mail d'une bannette.

#56983 : Correction du filtrage par défaut des bannettes privées
L'équation de recherche était appliquée sur toutes les bannettes, y compris les publiques. C'est corrigé. Elle ne s'applique que sur les bannettes privées maintenant.

#57283 : Bannettes cumulatives
Correction sur la purge des éléments dépassant la limite.

#58206 : [Gestionnaire de tâches] DSI privées
Contenu aléatoire dans les tables temporaires.
Problème :
- Multiples équations sur une même tâche du planificateur
- Tables temporaires de même nom non supprimées avant création

--------
Editions
--------

#49553 : [Templates de notices] #linked_id
Correction sur la récupération des relations horizontales

#49575 : Tri des états personnalisables
Tri de nouveau fonctionnel sur les entêtes de colonnes.

#50798 : [Template de bannette] Modification du template par défaut
L'altération à la mise à jour de la base de données se fera uniquement sur le "template PMB" s'il n'a pas été personnalisé. 

#51616 : Fonction de template #expl_num_with_tpl();
Correction sur la prise en compte de la limite.

#51963 : Fonction de template #date_bulletin
Changement dans la fonction pour récupérer uniquement le libellé de période ou uniquement la date au format JJ/MM/AAAA en plus de l'ancienne option.

#52089 : [Lecteurs] Abonnements dépassés
Prise en compte du filtrage sur la catégorie et le code statistique lors de la relance d'adhésion.

#52490 : Fonction de template #initiale();
Non renvoi du caractère final si la valeur de départ est vide.

#52901 : Export des réservations
Élimination des balises HTML à l'affichage du titre de la notice.

#54209 : Tri sur la colonne "Retour prévu" dans le tableau des réservations
Le tri sur la colonne "Retour prévu" n'était pas optimal avec les dates et les valeurs textuelles.

#54536 : Gestion du "limit" dans la partie Editions>Etats>Personnalisables
Suppression de la limite SQL avant de l'exécuter lorsqu'elle est présente dans la requête paramétrée pour que celle-ci soit gérée par le paginateur.

#57671 : [Templates de notices] Correction de la fonction ISBD

------
Fiches
------

#53825 : Export des fiches vers excel
Correction de l'encodage.

----
OPAC
----

#47154 : facette concepts
En résultat de recherche la facette de concept s'affiche avec le bon label, le bon lien et le bon nom de formulaire

#49319 : Encodage sur la page du panier
Correction du message "Tout décocher" mal encodé sur la page de panier du lecteur.

#49361 : Ajout de notices externes dans le panier
Nous pouvons à nouveau ajouter des notices externes (une par une) dans le panier.

#49367 : Style graphique des prêts en retard
Harmonisation de la CSS

#49755 : Affichage des notices filles à l'opac
Affichage des notices filles, 'pairs' et 'childs' à l'opac

#49785 : Affichage de notice dans une vue
Vérification de la visibilité dans la vue en accès direct "Permalink".

#49927 : Réservation d'un bulletin
Correction sur le double affichage du tableau des exemplaires lors de la réservation sur un bulletin.

#49930 : Pagination de la recherche affiliée
Résolution de la pagination dans les recherches affiliées.

#50047 : Problème de contexte : Partager résultat de cette recherche

#50110 : Gestion des catégories dans la classe d'affichage personnalisée Epires
Prise en compte du paramètre OPAC categories_show_only_last pour l'affichage des catégories.

#50115 : "Voir la suite" d'une bannette sur le portail
Correction de l'affichage du lien "Voir la suite" pour les bannettes publiques.

#50574 : Contributions : Correction d'une erreur JS à la modification d'un document numérique
Correction d'une erreur JS à la modification d'un document numériques issu des contributions.

#50713 : Encodage dans les recherches affiliées
Correction de l'encodage du mot "r&eacute;sultat(s)"

#50760 : Affichage de la note générale dans le template django common
Dans l'affichage détaillé du template django de notices "common", prise en compte des retours à la ligne dans la note générale.

#50895 : Filtres non fonctionnels dans la FAQ
Correction sur l'affinage des questions au travers des filtres.
Ré-indexation de la FAQ nécessaire.

#51138 : [Bloc de recherche] Comptabilisation des concepts 
Comptabilisation des concepts dans le bloc de recherche généralement situé dans un bandeau de recherche.

#51602 : Calcul de la taille d'un document numérique
Mauvaise construction de la méthode de calcul de la taille du document numérique.

#51710 : Groupement vide dans les recherches externes
Élimination de la zone vide dans le regroupement des sources externes.

#51714 : Surlignage dans une recherche avec l'opérateur "+"
Application du surlignage lorsque l'opérateur "+" est collé au terme recherché.

#51827 : [Recherche par tags] Partage du résultat de recherche
Le partage du résultat n'était pas fonctionnel dans la recherche par tags.

#51971 : Récupération d'éditeur par Zotero à l'OPAC
Zotero ne récupère plus "autre éditeur" dans l'import depuis l'OPAC.

#52107 : Espaces de contribution | Non réindexation des entités de la base
On ne ré-indexe plus les entités qui ne sont pas issues des contributions.
On accélère ainsi la validation des contributions.

#52295 : Statistiques OPAC : exclusion d'adresses IP au travers d'un proxy
Modification pour que le paramètre logs_excludes_robots puisse prendre en compte les adresses IP cachées derrières certains proxys.

#52348 : Tri dynamique des prêts précédents
Ajout d'un tri sur le tableau récapitulatif des prêts précédents à l'OPAC.

#52546 : Première connexion issue d'une DSI
Ne pas faire de redirection lors d'une connexion OPAC au travers d'un mail de DSI.

#52563 : [Alertes privées] Export
Le fichier d'export, si demandé, n'était plus associé au mail envoyé au travers de l'envoi sur l'OPAC.

#52658 : Tables temporaires : Génération du nom
Génération du nom de la table temporaire trop long dans certains cas. Généralement limité à 64 caractères.
Factorisation des différents appels de génération de tables temporaires dans les recherches.

#52684 : Mail d'information de suggestion à l'Opac
Lors de la création d'une suggestion à l'Opac, les mails d'avertissement n'étaient pas envoyés à l'adresse des utilisateurs souhaitant recevoir ce type d'alerte mais aux adresses mails renseignées dans les localisations d'exemplaire.

#52855 : Sélecteur de destinataire du formulaire de contact
Refonte du sélecteur pour mieux intégrer son contenu à l'aide de Dojo.js.

#52892 : Affichage du commentaire de l'auteur
Prise en compte des retours à la ligne sur l'affichage du commentaire de l'auteur.

#52895 : Lien "tout afficher" dans la FAQ
Correction du rebond vers l'affichage complet.

#53207 : [Vues OPAC] Utilisation du paramètre notices_display_modes
Prise en compte de ce paramètre éventuellement surchargé dans une vue pour l'affichage des notices.

#53251 : Encodage bouton "Tout décocher"
Correction du libellé parfois mal encodé. 

#53378 : Panier cliquable dans le zen
Dans le style Zen, avec le mode d'affichage simplifié du panier (paramètre OPAC 'simplified_cart'), le panier est maintenant cliquable suite à un ajout de notice.

#53815 : Suppression texte "changer mot de passe" en double

#53955 : [Listes de lecture] Fermeture de balise div
Correction de la mauvaise fermeture de balise HTML div.

#54117 : Export de notices
Sur certains exports, il manquait les en-têtes dans la construction du fichier de sortie.

#54190 : Portail - Surlignage
Surlignage incorrect avec le portail activé.

#54280 : Impression de notices en résultat de recherche
Lors de l'impression en PDF de notices à l'Opac en résultat de recherche dans un PMB en iso, si la notice utilisait des caractères Windows (Expl: apostrophe inversée) alors ces caractères n'étaient pas présent.

#54282 : [Page d'un bulletin] Filtrage des dépouillements
Prise en compte des droits d'accès et des vues OPAC lors de la récupération des dépouillements associés au bulletin.

#55050 : Libelle alternatif de liens et d'images à l'opac
Ajout de libellés alternatifs (attribut "alt") sur certaines images de l'opac et suppression de ceux qui étaient appliqués sur des liens.

#55493 : Vérification de l'email
Changement des formulaires de l'inscription en ligne et de l'ajout/édition de lecteur pour vérifier la validité des email fournis.

#55528 : Impression d'un panier
Correction de l'icône de type de document qui ne restait pas alignée avec le titre de sa notice

#55650 : Droit de visibilité à partir de la recherche par carte
Correction sur la prise en compte des droits de visibilité.

#55668 : Visionneuse de documents numériques
Correction de l'affichage des documents dans la visionneuse suite à l'application d'une facette lors d'une recherche.

#55882 : Inscription lecteur - Durée d'adhésion
On fixe désormais la durée d'adhésion du lecteur à 365 jours lorsque le paramétrage de la catégorie par défaut en inscription OPAC est incomplet.
Sans cela, l'inscription ne fonctionnait pas.

#55916 : Affinage suite à une recherche par TAGS
Cela n'était pas fonctionnel.

#56148 : PMB ISO-8859-1 : Formulaire de contact
Les caractères accentués posaient problème sur certains PMB en ISO-8859-1.

#56170 : Formulaire de contact - Mode de choix des destinataires "Par personnes"
Correction du problème d'envoi vers la première personne de la liste.

#56194 : [Catégories] Auto-complétion multi-langues
Correction de l'interrogation multi-langues en auto-complétion.

#56314 : Flux RSS des veilles
En fonction de l'encodage du PMB, le header html envoyé au navigateur n'étant pas précisé il y avait des soucis d'affichage avec les caractères accentués.

#57220 : Correction de la multi-critères en "glisser-déposer"
Les recherches prédéfinies écrasaient la globale "$search". Par conséquent, la multi-critères ne fonctionnait pas correctement.

#57269 : RMC : CP à partir d'un sélecteur d'autorités
La recherche n'était pas fonctionnelle.

#57938 : Tri dans les listes de lecture
Si le paramètre Opac default_sort_list à 0, la popup affiche les tris disponibles

#58110 : [SPHINX] Transformation recherche simple en RMC
Avec Sphinx, si on applique un affinage sur une recherche simple ou un rappel d'historique de recherche simple, la recherche de base n'était plus faite avec Sphinx. 

#58288 : Permalink de recherche : Affinage
Correction de la fonction "affiner la recherche" à partir d'une recherche lancée depuis un permalink de partage.

#58389 : Fatal error: Call to a member function get_display_links()

#58696 : Statut de doc numérique : Téléchargeable Oui & Consultable dans la visionneuse NON
Affichage direct du document lorsqu'il n'est pas consultable dans la visionneuse.

#53239 : Erreur d'appel d'images dans le style common.css à l'Opac
Les liens renseignés comme image next.png et prev.png d'arrière plan n'étaient pas bons.

#58180 : Correction vulnérabilités de type XSS
Si injection de &user_query='"><sVg/oNLoad=confirm(/xssposed/)> dans les recherches et historique

-------
Portail
-------

#49613 : Sélection ajax pour les champs de type sélecteur d'autorité dans le contenu éditorial
Implémentation de l'auto-complétion.

#49953 : Contenu éditorial : correction de l'enregistrement du portfolio
Incomplet entre la 5.0.4 et la 5.0.5

#50008 : [Contenu éditorial] Editeur TinyMCE : Rechargement AJAX
Pour les PMB paramétrés avec l'éditeur TinyMCE dans le portail, le changement de rubrique ou d'article ne ré-affichait pas l'éditeur dans les champs concernés.

#50633 : Bug d'affichage du portfolio en partie gestion
Résolution du bug d'affichage du portfolio en partie gestion lorsque le paramètre général vignette_x et / ou vignette_y est modifié.

#51384 : H2o Django => filtre length sur une chaine de caractères
Correction d'une erreur de calcul de la taille d'une chaîne en Django avec le filtre length.
La valeur retournée était systématiquement 1.

#51671 : Indexation du contenu éditorial
Correction d'un problème d'indexation sur les catégories associées

#51698 : Nombre de notices dans le module bannette
Correction sur la prise en compte du nombre de notices à afficher.

#51785 : [Portail] Récupération des concepts indexant une autorité
La récupération des concepts indexant était en direct et en chargement à la volée par une autre méthode.
Le chargement à la volée est le seul à devoir rester.

#52766 : Contenu éditorial : correction de l'enregistrement du portfolio
On recalcule les documents associés avant d'éventuellement les modifier.

#52777 : Module liste de notices / Source de données "notices avec des catégories communes"
Fonctionne à nouveau.

#53771 : Optimisation des tables cms_articles et cms_sections
Modifications en base de données :
Passage du champ article_publication_state de la table cms_articles en type entier.
Passage du champ section_publication_state de la table cms_sections en type entier.

#53928 : Problème de tri après filtrage sur certains modules portail
Les classes de filtrages utilisent la méthode array_intersect qui conserve les clés de tableau.
Après filtrage, on se retrouvait donc parfois avec un trou dans le tableau qui fausse l'algo de tri derrière.
C'est maintenant corrigé!

#54300 : Optimisation de la récupération du contenu éditorial 
Dans le module liste de rubriques, si l'option est coché seul le premier niveau ne récupérait pas les articles

#55061 : Correction portfolio
On ne pouvait plus décocher une image sélectionnée. C'est corrigé. 

#55431 : Correction Récupération des notices depuis les catégories (filles incluses) d'une rubrique
Dans la source de données qui récupère des notices par les catégories matchant avec celle d'une rubrique, la requête comportait une erreur.
Lorsque l'on activait l'option pour inclure les categories filles également, la catégorie "mère" ne sortait plus.

#56133 : Contenu éditorial | Compression des images jpg
Compression anormale des images jpg dans le contenu éditorial.
Si le fichier jpg pèse moins de 100ko, on ne réduit pas la qualité, sinon on garde la qualité par défaut de imagejpeg (75%)

#57991 : Upload de document numérique dans le Portefolio
L'upload de document numérique dans le Portefolio ne fonctionnait pas pour certaine configuration de serveur, lorsque l'information "Content-Length" n'était pas présente dans le header.

#58433 : Métadonnées - problème d'encodage
Encodage des métadonnées.

#58702 : Retour du message "Contenu sauvegardé"
Retour du message à l'enregistrement d'un article ou d'une rubrique.


*******************
EVOLUTIONS


------------
Acquisitions
------------

#50378 : Compatibilité MS Excel - Export suggestions
Amélioration de la compatibilité MS Excel en export de suggestions.

#52738 : Réservation automatique pour les demandeurs à la réception sur paramètre
Nouveau paramètre dans la partie Acquisition : sugg_to_cde_resa_auto.

#52837 : Piece jointe dans le tableau et l'édition des suggestions
Changement des images illustrant les actions possibles sur une pièce jointe dans le tableau des suggestions, ajout de boutons "Consulter" et "Importer" en édition d'une suggestion.

#54026 : Type de produit dans les commandes
Paramètre pour obliger la saisie du type de produit dans les commandes ('type_produit').
Préférence utilisateur pour avoir un type de produit de sélectionné par défaut.

--------------
Administration
--------------

#49360 : Connecteur de Flux RSS
Ajout du connecteur de Flux RSS.
Gestion de la norme RSS 2.0 et Atom 1.0

#49372 : URL du formulaire de contact
Ajout du lien vers le formulaire de contact au niveau du paramétrage de ce dernier.

#49506 :  Classement des opérations en Nettoyage de base
 Classement des opérations en Nettoyage de base.

#49857 : [Exercice comptable] Sélecteurs de date
Sélecteurs de date dans le paramétrage d'un exercice comptable.

#49983 : Nouvel attribut z3950
Ajout de l'attribut Z3950 "Identifiant de notice"

#50581 : Désactivation du graphe par défaut
Désactivation du graphe par défaut pour les nouvelles montées de version (4.2 vers 5.0+).

#50625 : Synchronisation "Connecteur Arte VOD"
Modification de la requête allant récupérer les notices non intégrées.

#50758 : [Gestion des images] Bouton d'ajout
Affichage du bouton d'ajout en haut de la liste lorsque cette dernière dépasse les 20 éléments.

#51679 : Nettoyage des relations
Suppression des catégories orphelines associées au contenu éditorial dans le nettoyage de base.

#51787 : Espaces de contribution | Paramétrage rapide
Ajout d'un lien en paramétrage de contribution pour paramétrer les webservices correspondants en un clic.
Le lien n?apparaît que si le champ "URL" est vide. Il crée un groupe externe dédié, un utilisateur externe dédié, un connecteur sortant de type json/rpc et gère les autorisations.

#51871 : [Champs personnalisés] Valeurs par défaut
Ajout de valeurs par défaut dans les options à la création de champs personnalisés.

#53750 : Template par défaut d'enrichissement ArteVOD
Amélioration du template par défaut.

#54219 : Conversion des notices Cairn.info
Évolution faite par l'équipe Cairn.info : ajout d'un tiret sur le numéro de bulletin en lieu et place d'un caractère vide.
Désormais côté PMB : récupération du numéro de bulletin si différent du tiret ('-').

#54229 : Moissonnage d'un entrepôt OAI
Option supplémentaire "Toutes les notices" en amont de la synchronisation.

#54278 : Ajout du mimetype audio.ogg dans le fichier manifest.xml
L?extension ogg est maintenant prise en compte dans module audio de la visionneuse. 

#54379 : Nouvelle fonction de stat OPAC
Ajout d'une fonction de stat OPAC #top_level_domain(); pour récupérer le domaine de premier niveau uniquement lorsqu'il provient d'une adresse externe.

#55412 : Confirmation en suppression de source externe
Ajout d'un message de confirmation pour l'éventuelle suppression des notices synchronisées.

#55620 : Connecteur OAI : afficher la description des sets
Description désormais affichée au survol sur le nom du set.

#55737 : Paramètre OPAC websubscribe_num_carte_auto
Modification du commentaire et de la valeur par défaut du paramètre.

#56354 : Planificateur de tâche - Entrepôts
Option pour vider l'entrepôt avant de démarrer la synchronisation.

#56742 : [Statut de document numérique] Visibilité vignette 
Nouvelle option disponible pour le statut d'un document numérique : ne pas tenir compte des droits pour l'affichage de la vignette
Cela a un intérêt pour l'utilisation de la vignette hors contexte du document numérique. Exemple : Vignette de la notice

#57034 : Liste des éléments associés lors de la suppression d'un critère d'exemplaire
Ouverture dans un nouvel onglet des liens vers les exemplaires présents dans la frame.

#57305 : Import lecteurs : Calcul automatique de l'identifiant si non précisé
Calcul automatique de l'identifiant du lecteur si non précisé (valeur de la colonne à 0) dans l'import par défaut.

#57886 :  Ajout d'un statut d'abonnement
Ajout d'un statut d'abonnement pour masquer ou différencier des abonnements dans le bulletinage.

---------
Autorités
---------

#49275 : Paniers d'autorités personnalisées
Il est désormais possible d'ajouter des autorités personnalisées dans des paniers du même type.

#51054 : Template django en gestion | Accès aux champs persos d'autorité via leur nom
Possibilité d'accéder à un champ perso d'autorité dans les templates Django en gestion en utilisant leur nom : {{ authority.p_perso.cp_name }}

#57349 : Ajout de messages dans l'impression de thésaurus
Ajout de messages dans l'impression de thésaurus pour pouvoir paramétrer les différents codes (TG, TS, TA...).

#57926 : Ajout du numéro d'autorité dans l'impression du thésaurus
Nouvelle option dans la page de paramétrage de l'impression

---------
Catalogue
---------

#50077 : Audit sur les documents numériques
Ajout des infos d'audit (qui a ajouté, qui a modifié quand) sur les documents numériques.

#51042 : Bouton d'historique des periodiques, bulletins et articles
Ajout d'un bouton pour consulter l'historique de modification d'un bulletin ou d'un article sans avoir à l'éditer.

#51401 : [Sélecteurs] Contexte du module référent dans les pop-up

#51716 : [Permalink d'un bulletin] Titre de l'onglet
Amélioration du formatage du titre de l'onglet pour les bulletins.

#51835 : Recherche "Auteur/titre"
Nous ne conservons plus les mots vides lors d'une recherche sur un ou plusieurs termes dans le champ "Catégorie".

#51898 : Documents numériques:  Dépôt multiple et modification en popup
Ajout d'un paramètre "pmb_enable_explnum_edition_popup" permettant d'éditer les documents numérique au sein d'une popup.
Ajout d'une zone de dépôt sous les notices, permettant de déposer plusieurs documents numériques simultanément.

#52703 : Tri des documents numériques en gestion
Nouveau paramètre dans les paramètres généraux : explnum_order

#52986 : Fermer la session le plus tôt possible
Lors de l'affichage des éléments d'un panier, on ferme la session avant l'affichage de tous les éléments pour éviter un blocage ou une ré-écriture de la session. 

#53227 : Statut par défaut des notices d'articles
Nouveau paramètre utilisateur pour l'application d'un statut de notice par défaut en création d'article.
Par défaut, la valeur sélectionnée est "Notice de bulletin".

#53650 : Numérotation automatique d'un exemplaire déjà créé
Case à cocher "numérotation automatique" dans la pop-up en édition de CB.

#53716 : [Nb caractères] Libellé de l'étagère
Augmentation de la taille maximale de caractères pour le nom d'une étagère : 255 caractères

#53936 : Ajout du dépôt multiple de documents numériques sur les articles de périodiques 

#53989 : Paniers > Editions
Ajout des langues de publication + originales dans les éditions de paniers.

#55768 : Alerte pour abonnements de périodiques à renouveler/dépassés
Ajout dans la zone d'alerte de l'onglet catalogue.

#56370 : Upload de documents numériques
Remplacement des "," par des "_".

#57175 : Recherche externe gestion : Critère "Notice importée"
Nouveau critère de recherche.

#57212 : Recherche externe gestion : Date de création
Interrogation de la date de création au sens unimarc "100$a" en lieu et place de la date d'import.

#57296 : Recherche externe : Signaler les documents numériques
Les documents numériques sont maintenant signalés au niveau du header de la notice.

#57601 : Import BDP avec inversion de titre propre et titre de série
Ajout d'une nouvelle fonction d'import basées sur celle de la BDP mais qui en plus inverse le titre propre et le titre de série.

#58565 : Ergonomie de la page de validation des tags
Amélioration de l'ergonomie de la page de validation des tags et harmonisation avec la page des avis.

#58668 : Recherche BnF Z39.50 sur ISBN 10/13 
Ajout de la recherche sur l'ISBN 10 converti lors d'une recherche sur une ISBN 13, non reconnu par la BnF.

-----------
Circulation
-----------

#49689 : Optimisations dans la gestion des photos de lecteurs
Ne pas indiquer que la sauvegarde de la photo est réalisée quand cela n'est pas le cas..

#50068 : Index sur la circulation des périodiques
Ajout d'un index sur les tables SQL de circulation des périodiques.

#55707 : Demandes de numérisation : tri par défaut
Modification du tri appliqué par défaut pour : tri croissant sur le statut, puis un tri décroissant sur la date.

#58183 : Mail de confirmation de réservation
Amélioration de la substitution de l'objet du mail.

--------
Demandes
--------

#53892 : [FAQ] Saisie HTML autorisée
Autorisation de la saisie de code HTML dans les Questions/Réponses.

------
Divers
------

#49646 : Transformation du caractère Em Dash
Transformation du caractère cp1252 Em Dash en ' - '

#49926 : Tri de résultats sur le critère "Nouveautés"
Ajout du tri sur le critère "Nouveautés" dans la liste des tris possibles.

#50707 : [Options pour le débogage] Paramètre display_errors
Affichage des erreurs SQL via la fonction pmb_mysql_query afin de gagner du temps sur le diagnostic.

#50721 : Option supplémentaire sur les champs perso URL
Case à cocher dans les options pour que l'ouverture dans un nouvel onglet soit activée par défaut.

#51389 : Optimisation de la gestion des sessions pour les vignettes de document numérique
Fermeture de la session Php dès que c'est possible lors de l'affichage des vignettes des documents numériques.

#52284 : Ajout du filtre shortmonthletter dans les templates Django côté gestion
Ajout du filtre shortmonthletter dans les templates Django côté gestion pour afficher le mois en version courte.

#52586 : Rebonds sur la modification de paniers
Ajout de rebonds la modification de paniers à divers endroits dans l'interface.

#52704 : Gestion du temps de la durée de session en partie gestion
Deux nouveaux paramètres dans les paramètres généraux :
session_maxtime : Durée maximale de la session (en secondes).
session_reactivate : Durée maximale de la session sans rafraîchissement (en secondes).

#52770 : Classes CSS paginateur
Possibilité de charter les éléments du paginateur (numéros + sens) en gestion et en OPAC.

#52888 : Afficher tout le commentaire des CP
Plus de restriction sur le nombre de caractères à l'affichage.

#53764 : Pagination des listes
Meilleure gestion de la pagination personnalisée.

#53944 : Autorisations accordées selon le groupe d'utilisateurs
Groupement des autorisations par groupe d'utilisateurs (sur les paniers, actions sur paniers, actions personnalisables, etc.).

#57470 : Documents à traiter : Description du champ dans /doc/noyau/
Modification du message "Exemplaire à problème dans la localisation qui fait le retour" pour "Identifiant de la localisation où le document est présent physiquement, et a un traitement non effectué" sur le champ expl_retloc de la table exemplaires.

#57494 : Connecteur ArteVOD : URL référente
- Suppression des informations d'identifiant/mot de passe n'étant plus utilisés.
- Ajout de l'URL référente dans le paramétrage commun aux connecteurs ArteVOD.

#58080 : Facettes externes sur la source
Ajout du filtre sur la source dans les facettes.
A condition que le champ unimarc 801$b soit renseigné dans l'entrepôt PMB.

#58094 : Calcul des index Sphinx pour les documents numériques + documents numériques sur bulletin sans notice
Modification de l'algo pour ne plus les faire par passe de 100.
On récupère maintenant tous les identifiants, puis on déclenche les requetes à l'unité, c'est bien plus efficace quand il y a de la volumétrie.
On corrige au passage l'indexation plein texte pour les documents numériques  associés à un bulletin sans notice de bulletin.
Ils n'étaient plus interrogeable via Sphinx. 

#58356 : Prise en compte d'un tag title dans les manifest de plugin
Le fichier manifest.xml d'un plugin peut maintenant intégrer une balise <title> juste avant un hmenu.
Ce titre sera repris en H1 dans le contenu  de la page générée

---
DSI
---

#49265 : Récupération des catégories d'articles et de rubriques dans les veilles
Dans une source de données basée sur le contenu éditorial, on récupère maintenant les descripteurs associés aux articles et rubriques sur les items.

#50994 : [Templates de bannettes] Nombre d'abonnés
Possibilité de récupérer le nombre d'abonnés dans le contenu de la bannette.

#51599 : Ajout d'un paramètre pour filtrer les bannettes privées avec une équation de recherche
Paramètre DSI : private_bannette_search_equation

#52889 : Index SQL dans la table bannettes
Nouvel index sur le champ SQL bannette_tpl_num.

#54194 : Module de veille / Surveillance de site
Clarification des différents éléments de paramétrage.

#56782 : Connexion automatique depuis les bannettes sur paramètre
Nouveau paramètre D.S.I pour activer ou non la connexion automatique à l'OPAC depuis le contenu d'une bannette.
Nom du paramètre : connexion_auto

--------
Editions
--------

#49696 : [Gestion des caisses] Affichage des prix
Affichage des prix conditionnés sur le paramètre "pmb_fin_precision" (généralement à 2). 

#52489 : Fonction de template #strtoupper();
Prise en compte des caractères accentués. 

#52959 : Template de notices - créateur de la notice
Nouvelle fonction #creator();
param0 = Format d'affichage : 0 : Nom Prénom 1 : Login 

#52960 : Template de notices - Mots-clés
Nouvelle fonction #keywords(); pour récupérer les mots-clés de la notice.

#53282 : Mise à jour de la doc pour la fonction de template #categories_with_tpl();

#54579 : Modèles de planches d'étiquettes
Enrichissement de l'interface pour que ce module soit utilisable pour l'impression des étiquettes de cote.
Les planches définies en partie Éditions seront désormais visible dans la liste des formats disponibles en impression par panier.

----
OPAC
----

#41744 : Espaces de contribution : Ajout de commentaires, info-bulles et placeholder
Possibilité de définir des commentaires, info-bulles et placeholder sur les champs des formulaires de contributions.

#49707 : [Envoi de mails] Liens absolus
Formatage des rebonds vers les autorités

#49834 : Détail des champs perso de type autorité dans les templates de notices Django
Accès à la structure identique aux pages FRBR au travers de la propriété "details"

#50026 : Lien de désinscription de la DSI
Permettre aux usagers de se désinscrire de l'alerte via un lien dans le contenu du mail.
Une confirmation lui est demandée.

#51041 : Substitution de la css du toolkit dans un style personnalisé
Rendre possible la substitution de la css du toolkit dans un style personnalisé

#51385 : Ajout de la possibilité de croiser les requêtes d'historiques à l'OPAC
Dans la page historique des recherches, il est maintenant possible de cocher plusieurs ligne de recherche, et de cliquer sur rechercher.
Une multicritère croisant les différentes lignes cochées sera alors lancée.

#51596 : Ajout du choix de la date des notices pour remplir dans les bannettes privées
Ajout d'un sélecteur dans le formulaire de bannette privée (OPAC) pour choisir la date de création ou la date de mise à jour des notices + paramètre 'dsi_private_bannette_date_used_to_calc' pour définir le comportement par défaut.

#51756 : Templates django de notices : informations de son périodique
Récupérer les informations de périodique depuis un article ou un bulletin :
Les informations sont désormais accessibles au travers de la propriété {{ record.serial }}.

#51880 :  Historique de recherche
Refonte du template

#51907 : [Templates Django] Date de création et modification de la notice
Possibilité de récupérer la date de création et la date de modification de la notice dans les templates Django : {{ record.create_date }} / {{ record.update_date }}

#52393 : Gérer vos abonnements aux newsletters
Ajout de classes CSS

#52543 : Modification ISBD éditeurs
Modification de l'ISBD par défaut des éditeurs.

#52774 : Ajout vignette amazon pour les cd 
utilisation du web service Amazon
Nécessite de paramétrer le connecteur AWS ECommerce Service:
AWSAccessKeyId
Clé privée
AssociateTag

#52833 : Formulaires de contributions | Ajout d'une patience au versement d'un document numérique
Ajout d'un icône de patience lors du versement d'un document numérique le temps du traitement de dédoublonnage.

#53178 : [Demandes de numérisation] Envoi de mail
Envoi d'un mail après modification.
Émetteur du mail : Émail du lecteur
Destinataire du mail : Émail de la localisation

#53457 : Personnalisation des coins Zotero avec template django
Possibilité de personnaliser les coins avec une classe spéciale pour l'appel côté Django.

#54061 : Modification de l'appel aux données des cadres

#54727 : Déselectionner toutes les facettes à l'OPAC
Ajout d'un bouton "réinitialiser" pour retrouver la recherche sans aucune facette.

#54843 : Parametre opac avis_show_writer
Modification du paramètre pour permettre d'afficher uniquement le prénom de l'auteur d'un avis.

#55969 : Navigateur : lien manquant depuis mon compte
Affichage du lien "nouvelle recherche" dans le navigateur.

#56745 : Chargement ajax pour les dernières notices en page d'accueil
Elles sont désormais chargées en AJAX.

#56931 : Recherche par termes : Auto-complétion 
Auto-complétion désormais active en saisie dans la recherche par termes.

#57138 : Modification d'URLs
Modification d'URLs dans PMB pour ne pas avoir de point d'interrogation sans rien à la suite.

#57688 : [Notification de réservation OPAC] Localisation de retrait
Précision de la localisation de retrait lorsque cela est nécessaire.

#57731 : [SPHINX] Prise en compte des "datatype" du champ base pour les modes de recherche
On prend maintenant en compte l'attribut "datatype" du champ base pour les recherches par "mode".
Ex : dans search_fields.xml, on trouve :
@<query for="BOOLEAN" wordSearch="yes" stemming="no">
  <class type="records" mode="authors"></class>
</query>@
Cela ira maintenant chercher dans tous les champ/sous-champ associé à un datatype="author" dans le champs_base.xml

#57888 : Cadre d'authentification lors du clic vers un lien du compte lecteur
Lors de l'appel à un lien vers le compte lecteur, si celui-ci n'est pas encore connecté on lui affiche le cadre d'authentification, puis le succès de connexion le fera suivre vers son lien original.

#58735 : Mentions légales sur Genbib
Suppression des mentions légales dans le README.

-------
Portail
-------

#49458 : Intégration du toolkit masonry
Le script JavaScript est maintenant ajouté à pmb en tant que toolkit.
Un paramétrage de base a été réalisé afin de simplifier son activation :
- l?élément DOM conteneur des éléments disposé en masonry doit avoir une class css unique nommée : ms-grid-container
- les éléments disposé en masonry doivent avoir une class nommée : ms-grid-item

#50132 : Date de la dernière génération du cache portail
Affiché au survol sur le bouton "Vider le cache".

#50190 : Tri des étagères dans le module liste d'étagères
Personnalisation possible du tri à partir du cadre.

#50941 : Sources de données sur catégories intégrant l'autopostage
Ajout d'un bouton radio pour étendre aux catégories filles dans les sources de données permettant de  :
- récupérer une liste de notices indexées avec les mêmes catégories qu'un contenu éditorial 
- récupérer une liste d'articles indexées avec les mêmes catégories qu'un contenu éditorial 

#51312 : Variable Django pour le statut de lecteur
Variable Django {{ session_vars.empr_statut }}.

#51705 : Option "A t-on besoin des informations sur les articles associés ?" dans le module rubrique
Possibilité de ne pas aller chercher les informations des articles associés à la rubrique lorsque l'on en a pas besoin.

#51838 : Traduction du contenu éditorial
Traduction du contenu éditorial grâce à une mécanique de champs persos.

#51873 : Module rubrique > Rubrique depuis un CP de la rubrique
Ajout d'une nouvelle source de données.

#52381 : Page FRBR : ajout d'une source de données
Ajout de la source de données : "entité enfant utilisant l'entitié parent dans un champ perso".

#53885 : Filtre sur les cadres du portail en construction
Prise en compte de l'identifiant complet dans la recherche de filtrage afin de pouvoir saisir "sectionslist" pour visualiser tous les cadres portant sur des modules "Listes de rubriques".

#54301 : Optimisation de la récupération des champs persos du contenu éditorial (singleton de classe)
Mise en singleton de la classe pour les champs génériques

#54976 : Portail | Module de recherche | Possibilité de rechercher dans les vues
Possibilité de créer de nouveaux boutons radios sur le cadre de recherche à l'OPAC pour aller chercher dans des vues spécifiques.

#55302 : Tag H2O imgbase64
Ajout d'un tag imgbase64 dans les templates H2O.
Permet d'injecter le code nécessaire dans un attibut src pour afficher une image en base64 depuis le fichier.
Exemple d'usage : @<img src="{% imgbase64 images/logojpg %}"/>@
deviendra : <img src="data:image/jpg;base64,..."/>

#55468 : Mise à jour libellé / vignette à l'upload d'une image dans le contenu éditorial

#56017 : Identifiant du cadre dans le formulaire de modification
Affichage de l'identifiant du cadre de portail en haut du formulaire.


*******************
DEVELOPPEMENTS


-----------
Circulation
-----------

#57306 : Ajout impression de plusieurs prêts - Imprimante ticket de prêt raspberry
Ajout de l'impression de plusieurs prêts sur l'impression de ticket de prêt via raspberry.

------
Divers
------

#57653 : Trombinoscope dans bibloto
Ajout d'un trombinoscope des lecteurs pour se connecter.
Ajout d'une recherche filtrant les photos à l'écran.
Ajout d'un paramètre supplémentaire sur le connecteur bibloto "trombinoscope_enabled".

-------
Portail
-------

#54298 : Optimisation du portail (singleton pour les classes de modules)
Mise en singleton des classes pour la génération du portail.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.5                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


------------
Acquisitions
------------

#46416 : Sélection des notices en création/modification de devis
Insertion de plusieurs notices en même temps 

#45727 : Recherche sur les frais annexes
Correction sur l'affichage des frais dans la popup.

#49100 : Personnalisation des lettres de commande
La modification du paramètre pdfcde_print de commande pour personnaliser la lettre n'était plus fonctionnel dans certaines conditions.

--------------
Administration
--------------

#45087 : Actions personnalisées : Autorisations
L'utilisateur sélectionné n'était pas l'utilisateur courant.

#45092 : Suppression de l'enrichissement sans libellé
Une zone d'enrichissement ne correspondait à aucun type de notice.

#45050 : Conversion USMARC @BOOKS -> UNIMARC ISO2709
Lors de la conversion USMARC @BOOKS -> UNIMARC ISO2709 une erreur était affichée et empêchait la conversion de la notice si celle-ci avait un champ 653.

#45769 : [Gestionnaire de tâches] Calcul de date erroné dans un cas précis
En ce jour du 07/03/2018 :
- Jour 1 du mois (inférieur à celui d'aujourd'hui)
- Tous les jours de la semaine
- En Janvier et en Juillet 
Le calcul s'appliquait pour le "01 janvier 2019".

#46187 : Recherche prédéfinie OPAC : Champ titre uniforme
Le champ de sélection d'un titre uniforme dans la recherche prédéfinie OPAC est de nouveau fonctionnel.

#47280 : Ajout d'index MySQL
Deux nouveaux index :
- Sur le champ num_empr de la table opac_liste_lecture
- Sur le champ resp_groupe de la table groupe 

#47686 : Traductions des recherches prédéfinies
Changement du paramètre contrôlant les traductions disponibles pour les noms de  recherches prédéfinies.

#47701 : Conversion USMARC @BOOKS et USMARC ISO2709
Lors des conversions USMARC @BOOKS et USMARC ISO2709 une erreur était affichée et empêchait la conversion de la notice si celle-ci avait un champ 653.

#47794 : Connecteur ArteVOD | Ecrasement de notice via l'import planifié
L'import ArteVOD via le planificateur n'écrase plus les notices modifiées.

#48099 : Message automate de prêt
L'accès aux messages de l'automate de prêt est rétabli.

---------
Autorités
---------

#46527 : Problème d'index suite à un remplacement de catégorie
Lorsqu'on remplace une catégorie par une autre, les notices liées à la catégorie sont maintenant ré-indexées

#45459 : [Plan de classement] Création indexation décimale
Pouvoir choisir le plan de classement en création/modification d'indexation décimale

#45808 : Tri autorité personnalisée
La génération de l'indexation "authperso_infos_global" doit respecter l'ordre des champs personnalisés de l'autorité perso

#45825 : Tri et pagination des autorités
Le tri des autorités par pertinence est amélioré pour ne plus retrouver les mêmes autorités sur les différentes pages.

---------
Catalogue
---------

#45644 : Opérateur _ (commence par en recherche booléenne) 
Correction de la prise en compte de l'opérateur _ en recherche booléenne.

#47109 :  Gestion de doubles numéros exceptionnels et Nombre de numéros dans la série
Dans la grille d'abonnement de périodique, prise en compte du nombre saisie, même si un bulletin a été marqué comme reçu

#44743 : Duplication de notices : Lien vers celle d'origine
Il faut pouvoir lier la notice dupliquée à celle d'origine.

#44788 : MAJ Document numérique : base -> upload
Correction du passage d'un document numérique stocké en base de données vers un répertoire d'upload.

#45480 : Z3950 : Suppression des "-" dans les ISBN avant la recherche
Suppression des "-" dans les ISBN avant la recherche Z3950 pour améliorer les résultats.
Certains ISBN sont renseignés sans "-" à la BNF par exemple.

#45775 : Collecte de paniers en RFID
Suite à la refonte des paniers, les id 'nb_item' et 'nb_item_pointe' ont été supprimés provoquant une erreur javascript en mode RFID.
Ce qui stoppe la lecture cyclique RFID.

#45783 : Filtre par localisation dans les états des collections
Le filtre par localisation n'était pas fonctionnel lorsque la localisation appliquée par défaut était "Toutes les localisations" (via le paramètre utilisateur).

#46003 : Suppression d'un exemplaire inconnu dans les paniers
Si collecte d'un exemplaire inconnu dans un panier, possibilité de le supprimer du panier

#46135 : Remplacement de notice par Z3950 : Préremplissage du champ ISBN
Lors d'un remplacement de notice par Z3950, le premier sélecteur est positionné sur ISBN.

#46224 : Sélection d'une autorité personnalisée dans les recherches multicritères
Correction de la sélection d'une autorité personnalisée via un champ personnalisé dans les recherches multicritères (lecteurs, notices, autorités).

#46625 : Inversion de relation horizontale lors du passage en 5.0
Correction de l'inversion des libellés lors du passage en version 5.0

#46843 : Duplication de notice avec nomenclature
On peut dupliquer une notice avec sa nomenclature.
Les sous-manifestations ne sont pas rattachées à la nouvelle notice.

#46999 : RMC en Drag'n'drop : Suppression du "Choisissez un critère..." dans l'arbre
Suppression du "Choisissez un critère..." présent tout en haut de l'arbre en RMC lorsque le drag'n'drop est activé.

#47118 : Bulletinage 
Possibilité d'utiliser les champs perso d'autorité en bulletinage.
Ajout de la complétion

#47209 : Photos stockées dans PMB
Prise en compte du parametre $pmb_notice_img_pics_max_size

#47311 : Affichage des entités HTML dans les ISBD de notices (Bis)
Protection des entités HTML afin qu'elles s'affichent correctement dans les en-têtes et ISBD de notices.

#47943 : Ré-affichage des date dojo au changement de type de document 
Correction du ré-affichage des dates dojo au changement de type de document dans les formulaires notices.

#48126 : Indexation de champs HTML : Ajout d'espaces à la place des balises
Ajout d'espace à la place des balises lors de l'indexation de champs HTML.
Cela empêche de coller deux mots séparés uniquement par des balises.

#48322 : Sélecteur de concept dans les procédures de paniers 
Les sélecteurs de concept dans les procédures de paniers renvoyait une URI au lieu d'un ID, c'est maintenant corrigé.

#48615 : Harmonisation de champs en intégration Z39-50
Harmonisation de certains champs en intégration de notices depuis une recherche Z39-50.

#48964 : Prise en compte du paramètre utilisateur "Localisation par défaut en visualisation du bulletinage"
Dans la fiche d'un périodique en gestion, pour l'affichage des bulletins, on prend maintenant en compte le paramètre utilisateur "Localisation par défaut en visualisation du bulletinage" plutôt que "Localisation par défaut en visualisation d'un état des collections".

#49056 : Commentaire de champ personnalisé en gestion
Retour à la ligne pour l'affichage du commentaire de champ perso en gestion, prise en compte des retours à la ligne dans ce commentaire.

-----------
Circulation
-----------

#45770 : Prêt secouru : affichage des retours
L'affichage des retours secourus est corrigé.

#47338 : Confirmation de réservation : Nom du groupe
Correction sur l'affichage du libellé de groupe sur les lettres de réservation lorsque le paramétrage du groupe de lecteurs le demande.

#46831 : Paniers de lecteur en accès rapide
Correction sur l'affichage des paniers de lecteurs en accès rapide

#47331 : Prêt d'un document déjà en prêt en mode RFID
En mode RFID, si pret_already_borrowed à 1, pour un document déjà en prêt, le retour est effectué et le document est prêté automatiquement

#48544 : Gestion des noms composés dans la recherche lecteur
Possibilité de recherche des noms composés en utilisant la troncature dans la recherche simple de lecteurs

------
Divers
------

#47191 : Affichage des vignettes de notices
Lorsque le serveur correspondant au lien de l'image ne renvoyait pas la taille de l'image, alors celle-ci n'était pas affichée.

#44802 : Correction des exports OAI avec fonction d'import
Correction des exports OAI lorsqu'une fonction d'import utilisée (pmb_import_modele) contient des inclusions avec les variables $class_path ou $include_path non déclarées.

#44904 : [Concepts] : Nom du schéma dans les formulaires de saisie
Affichage des libellés de schéma devant les libellés de concepts en édition d'entités (notices, autorités,..). 

#44932 : Nettoyage des espaces insécables
Correction de la fonction clean_nbsp dans PMB.
Certains espaces insécables en début de chaîne se retrouvaient alors indexés et faussaient les résultats de recherche.

#45090 : Gestion des espaces dans les fichiers téléchargés
Possibilité de télécharger correctement un fichier dont le nom contient un espace.

#45177 : Calcul index Sphinx par passe
Pour les documents numériques, qui peuvent présenter de gros volumes de données, on procède par passe pour faire en sorte que ca ne plante pas

#45342 : Suppression ligne vide dans les formulaires utilisant les grilles

#45366 : Indexation document numérique et Sphinx
Correction d'une erreur SQL suite à la modification #45177 (indexation par passe)

#45826 : Prise en compte des exclusions de champs avec Sphinx
Dans le moteur Sphinx, correction de la prise en compte du paramètre OPAC exclude_fields et du paramètre en gestion search_exclude_fields.

#46057 : Utilisation d'ALIAS dans les requêtes avec jointure dans les indexations
Gestion des alias dans les requêtes imbriquées présentes dans les champs_base.xml

#46865 : Ajout d'un index sur les signatures de documents numériques
Ajout d'un index sur les signatures de documents numériques

---
DSI
---

#45761 : Module de veille / Surveillance de site
Correction du problème de ré-affichage des expressions XPath avec guillemets.

#46251 : Filtre par expression dans les veilles
Correction du filtrage par expression booléenne sur la veille dans le cas où le mot clé se trouvait en début d'index.

#47289 : Purge des bannettes archivées à la diffusion
Rétablissement de la purge des bannettes archivées au moment de sa diffusion en fonction du "Nombre de diffusions à conserver" .

--------
Editions
--------

#45829 : Champ date en gestion des caisses
Remplacement de l'ancien champ Date par un champ Dojo.

#46564 : Templates de notices : #linked_id();
Correction sur la récupération des liens entre notices

----
OPAC
----

#44874 : Correction templates Django common de notices
Dans les templates Django common de notices pour les articles, suppression du champ "Format :" qui faisait doublon avec "Article en page(s) :".

#45818 : Modification d'une recherche multicritères avec facettes
Le bouton "modifier la recherche" permet à l'utilisateur de modifier la recherche initiale (ajouter ou supprimer des critères) sans tenir compte des facettes

#44762 : Interdire le prolongement des prets chez les abonnes dont la carte nŽest plus valide
En OPAC, on calcul la date de prolongation en fonction de la date d'expiration de l'adhésion de l'emprunteur selon le paramètre pret_date_retour_adhesion_depassee

#45454 : Onglet de création d'alerte privée
Il y avait un problème de redirection lorsque l'on cliquait sur "Créer une alerte" via le compte lecteur dans un certain contexte.
Ce lien est maintenant redirigé sur la recherche multi-critères quelque soit le paramétrage.

#45494 : Sphinx : Prise en compte des recherche personnalisées à l'OPAC
Prise en compte de la recherche personnalisée spécifiée dans le paramètre OPAC > search_other_function lorsque Sphinx est activé.

#46347 : Calcul de la signature des résultats de recherche
Correction dans le calcul de la signature des résultats de recherche

#46699 : Sélecteur de catégories : Nombre par page
Correction sur la prise en compte de la personnalisation du nombre de catégories par page.

#46706 : Recherche booléènne sur les CP de notices
Correction d'une syntaxe incorrecte dans l'implémentation de la recherche booléenne sur les champs personnalisés de notices (Type de données "Texte"). 

#46805 : RMC : Recherche booléenne sur les champs persos
Report à l'OPAC de la recherche booléenne sur les champs personnalisés

#47093 : Page FRBR d'un concept
Il n'était pas possible d'ajouter un cadre à la racine d'une page de concept.

#47233 : Affichage dépouillements bulletins
Les dépouillements se ré-affichent dans le bulletin

#47296 :  Demandes de numérisations en gestion - envoyer un mail lors de la modification
Quand les demandes sont localisées, la création d'une demande génère l'envoi d'un mail à la localisation et un mail est également envoyé quand on modifie la demande pour choisir une autre localisation.
En opac la création d'une demande envoie le mail avec comme émetteur le nom prénom et mail de l'emprunteur, à destination du mail de la localisation

#47349 : Affichage de tous les dépouillements bulletins
Les dépouillements se ré-affichent dans le bulletin

#47849 : Alerte privée : Template de notices utilisé par défaut
Correction sur la prise en compte du template de notices utilisé par défaut lors de la création d'une alerte privée.

#48575 : Dédoublonnage de tags sur une notice
Le dédoublonnage sur les tags d'une notice ne se fait plus uniquement sur la chaine de caractère contenu dans le tag mais sur le tag entier.

#48638 : Recherche dans les listes de lecture
Correction de la pagination dans les listes de lecture.

#49000 : PMB ISO-8859-1 : Recherche sur un mot-clé ou tag avec accent
Correction d'un mauvais encodage sur les rebonds dans les mots-clés accentués pour les PMB en ISO-8859-1 avec les nouveaux affichages de notices.

#49076 : Selecteur recherche autorité OPAC
Changements dans la création des URL de la recherche.

#49163 : Lien vers un bulletin à partir d'un flux RSS
Prise en compte du permalink de bulletin pour les notices de bulletin.

-------
Portail
-------

#47382 : Carrousel du portail
Correction du problème de clic sur les liens du carrousel sur Firefox 59

#45091 : Formulaires de contribution : Nettoyage des noms de documents numériques
Nettoyage des noms de documents numériques avant l'enregistrement en base.

#45096 : Ouverture de la boite de dialogue dans l'onglet Portail
Correction d'un conflit entre CSS et JS si l'onglet principal est "scrollé".
Le dialogue s'ouvrait avec la partie haute de tronquée. 

#45739 : Lenteur affichage avec le portail
Accélération de l'affichage des rubriques et des articles

#45870 : Entités HTML dans un message du portail
Prise en compte d'entités HTML dans l'OPAC lorsque le portail est activé.

#46144 : Bouton "Vider le cache des images"
Ajout du bouton dans le contenu éditorial. Désactivation si on empêche la mise en cache d'images avec le paramètre active_image_cache

#46286 : Récupération du libellé de type de contenu dans les templates Django
Les libellés de type de contenu peuvent correctement être récupérés dans les templates Django des modules du portail.

#46311 : Contenu éditorial : correction de l'enregistrement du portfolio

#46470 : Bouton "Vider le cache" du contenu éditorial
Modification de la condition d'affichage du bouton pour avoir la même mécanique qu'en construction.

#46752 : Source de données de notices "Notice par valeur d'un champ perso" non fonctionnel
La table temporaire de make_search de n'étant pas détruite, les recherches suivantes sur le même champ ne s?exécutent pas

#47148 : scroll dans le contenu éditorial avec light
Correction du scroll dans l'arbre du contenu éditorial avec le style "light"

#47221 : Prise en compte de la recherche "concept" et "autorité perso"
Ajout de la prise en compte du paramétrage de la recherche simple pour le module de recherche portail

#47690 : Ajout d'un document numérique  à une collection dans le portail
Dans certain cas il était impossible d'ajouter un document numériques dans le Portefolio du portail à cause d'une erreur 411.


*******************
EVOLUTIONS


--------------
Administration
--------------

#45455 : Vérifier la présence des index sur les tables
Mise à jour du fichier récapitulant les différents index de la base de données.

#47650 : Connecteur OAI entrant | Affichage des erreurs
Affichage des erreurs lorsqu'il y en a dans le connecteur OAI.

---------
Autorités
---------

#45755 : [Fiche autorité détaillée] Libellé du plan de classement et du thésaurus

#48396 : "Searcher" des catégories : on n'affiche plus le noeud racine

#48982 : Substitution des icones d'autorités
Ordre de priorisation de récupération de l'icone :
1 - pmb/styles/<style utilisateur>/images/authorities/
2 - pmb/styles/common/images/authorities/
3 - pmb/images/authorities/

---------
Catalogue
---------

#45846 : Prix de l'abonnement hors modification
Affichage du prix d'un abonnement sans avoir à l'éditer.

#47636 : Sphinx | RMC "Contenu des documents numériques"
Le critère de RMC de notice "Contenu des documents numériques" utilise Sphinx (si celui ci est activé)

------
Divers
------

#44706 : Export des documents numériques de type URL avec URL OPAC PMB
Modification de l'export des documents numériques afin d'utiliser l'URL proxyfiée pour l'OPAC de PMB au lieu de l'URL directe.

#46537 : [H2o - Django] Fonction substring_until
Ajout de la fonction "substring_until" pour extraire une chaîne de son début jusqu'à la première occurrence trouvée.

#46772 : Indexation : Analyse du paramètre show_languages
On fait désormais attention aux erreurs de syntaxe (espaces + virgules en trop par exemple) au sein du paramètre "show_languages" de l'OPAC pour la ré-indexation d'entités.

#46808 : [RMC] Autorités multiples
En gestion et en OPAC :
- Ré-activation de l'opérateur lorsque toutes les valeurs sont vides (en cliquant sur les croix).

#46952 : Affichage des libellés dans l'édition Tableau+Excel de paniers
90% des libellés d'en-tête sont maintenant plus explicites.


#47137 : Modification ISBD oeuvres

#48100 : Evolution du DOM du layout du tableau de bord
Afin d'apporter plus de souplesse à la mise en forme du tableau de bord PMB un élément DOM à été ajouté au quatre layout django.

#48392 : Nouvelle version du thème Pure
Pure a été mis à jour corrigeant de nombreux bugs

----
OPAC
----

#45909 : Modification des templates django common de notices
Dans les templates django common de notices :
- Ajout du champ "URL associée" dans les affichages réduits
- Ouverture d'un document numérique dans un nouvel onglet si la visionneuse n'est pas activée dans les affichages réduits
- Modification des relations horizontales afin de prendre en compte le nouveau fonctionnement dans les affichages détaillés

#41753 : Infos supplémentaires dans les documents numériques
Ajout de:
- la date de création
- la date de modification
- le poids du document
Exploitables dans les templates django de notices
Exemple : 
{% for explnum in record.explnums_datas.explnums %}
create_date : {{ explnum.formated_create_date }}
update_date : {{ explnum.formated_update_date }}
file_size : {{ explnum.file_size }}
{% endfor %}

#44845 : Cache des images "+" et "-"
Mise en place du cache sur les images "+" et "-" permettant de déplier les notices, afin d'accélérer le chargement des pages.

#45776 : Inaccessibilité à un bulletin de périodique
Message pour indiquer qu'un bulletin n'est pas accessible.

#47032 : Mise en forme générique de le recherche multicritères 
Une mise en forme générique des nouveau outils de recherche développé pour pmb 5+ à été inclus a la feuille de style common.css 

#47889 : Mise en forme du template de notice centre doc avec le toolkit
Mise en forme des templates de notice centre docs pour les bases mise à jour ayant l'onglet toolkit activé.

#48394 : Suppression de la prise en compte des vues dans la génération des permaliens 
Suppression de l'identifiant des vues dans les liens générés au travers de la fonction get_permalink. 
Il est plus simple pour les graphistes de gérer les vues indépendamment.

#48601 : Modification d'une alerte privée
Ajout d'une option pour ne pas rediffuser le contenu de l'alerte à la suite d'une modification.

#48968 : Connecteur Cairn.info | SSO à partir des documents numériques de type URL
Le SSO du connecteur Cairn.info fonctionne sur les documents numériques de type URL dont le lien contient le motif "cairn.info"

#48977 : Paramétrage CSS de l'accès rapide au compte lecteur OPAC
Possibilité de masquer certaines entrées via la feuille de style ou le paramètre OPAC default_style_addon.

-------
Portail
-------

#44805 : Positionnement du navigateur de bulletins
Le navigateur de bulletins est désormais un cadre de l'OPAC

#45042 : Filtre sur les champs persos dans le module "Listes de notices"
Ajout d'un filtre permettant de restreindre une liste de notices dans le module en fonction d'une valeur de champs perso

#45796 : Ergonomie de l'arborescence du contenu éditorial
Ajout d'un splitter qui permet d'ajuster la largeur de l'arborescence et de la fenêtre de saisie

#46228 : Module "Liste de rubriques"
Nouvelle option dans la vue Django du module "Liste de rubriques" pour ne pas aller charger les informations sur les articles associés lorsque l'on en a pas besoin.
Note : A utiliser pour la construction des menus.

#46735 : Module Liste d'articles : Articles des catégories d'une rubrique
Nouvelle source de données "Articles des catégories d'une rubrique" pour le module "Liste d'articles".

#46779 : [Templates Django] Date de début et fin d'adhésion du lecteur
Il est désormais possible d'afficher les date de début et fin d'adhésion du lecteur dans les templates Django du portail via la propriété "session_vars".

#48735 : Valeur par défaut dans les listes de rubriques
Application du "non" par défaut à la question "A t-on besoin des informations sur les articles associés ?".

#48940 : [Liste de notices] Tri des notices récupérées à partir de CP
Possibilité de trier les notices récupérées à partir de la valeur d'un champ personnalisé.


*******************
DEVELOPPEMENTS

--------------
Administration
--------------

#49105 : Connecteur Isidore
Connecteur vers la base Isidore.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.4                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


------------
Acquisitions
------------

#40427 : Correction sur la génération d'un PDF de location
Correction d'une anomalie à la génération du PDF de la facture de décomptes lorsqu'il a de nombreux décomptes (et que la facture ne tient pas sur une page).

#40889 : Demandes de locations : Filtres sur les dates de fin
Correction du filtre sur les dates de fin.
Prise en compte de l'heure '23:59:59' (champs SQL au format datetime) pour inclure les lignes correspondantes à la date fin

#42829 : Création d'une suggestion
Correction du nom de l'utilisateur affiché lors de la création d'une suggestion côté gestion.

--------------
Administration
--------------

#40163 : Relations entre notices
Prise en compte du paramétrage des fichiers de relations pour l'import des notices et la création par défaut de la relation associée.

#43641 : Suppression de catégorie d'emprunteur
Prise en compte des guillemets et apostrophes dans le message de confirmation.

#39951 : Relations entre notices
Correction du sens de la relation en base de données pour les relations descendantes des notices importées.

#40482 : Nettoyage des doublons d'autorités
Suppression des doublons d'autorités arrivées à la suite d'une mise à jour de base de données tardive.

#40599 : La conversion "USMARC SPRINGER" ne fonctionne pas avec un PMB en utf-8
Avec un PMB en utf-8 la conversion "USMARC SPRINGER -> UNIMARC ISO2709" posait des soucis d'encodage.

#40936 : Option de champ personnalisable de type résolveur de lien
Correction du formulaire bloquant la suppression d'options.

#41145 : Encodage dans les rapports du tableau de bord
Encodage dans les rapports du tableau de bord. En ajax on passe de l'utf-8

#41331 : Message lors de la vérification des liens
Ajout d'un nouveau message lors de la vérification des liens et si un panier est sélectionné pour récupérer les liens cassés.

#41481 : Modification de paramétrage des transferts
Quand le sélecteur de la localisation de retrait pour une réservation change pour être valorisé en choix libre pour l'emprunteur, mise à jour des réservations non validées avec la localisation du lecteur en localisation de retrait par défaut.

#41664 : Gestionnaire de tâches : Variables globales manquantes pour les inclusions de fichiers
Variables globales manquantes.

#41746 : Description des tables : Possibilité de déplier la table visits_statistics
Il est maintenant possible de déplier les informations de la table visits_statistics dans la page "Description des tables"

#41905 : ArteVOD : Evolution du webservice
Correction du choix des types d'enrichissements et suppression des avis lors de la récupération des notices.

#41943 : Tâche de synchronisation externe
Correction de la gestion du formulaire lorsqu'un entrepôt est sélectionné.

#41969 : Tâche planifiée de sauvegarde
Correction du nommage de fonction afin d'éviter une erreur fatale.

#41983 : Fichier d'import modèle ENSAI/ENSAE
Suppression des tabulations de fin de fichier générant des erreurs dans les entrepôts OAI.

#42103 : Suppression d'un exemplaire
Correction des fonctions d'import incluant les répertoires classes et includes.

#42174 : Connecteur Zotero
Non-reprise de l'issn sur l'import d'articles lors de la synchronisation du connecteur.

#42991 : Exports RIS et RIS Zotero
Correction de l'export de l'éditeur.

#43493 : Conversion mémonotices vers unimarc PMB
Si la notice générée est un article, suppression du champ isbn/issn au sein de celle-ci.

#43618 : Relations entre notices
Suppression des liens unilatéraux en import, si l'on demande de ne conserver que les liens de la notice qui remplace

#43699 : Synchronisation du connecteur ArteVOD
Correction du code afin d'éviter une boucle infinie.

#43747 : Planificateur des tâches: fichiers de logs et informations
Ajout d'informations dans celles présentes lors de l'exécution du planificateur des tâches
Les fichiers de logs d'exécutions n'étaient pas supprimés du serveur.

#43780 : Entrepôts synchronisables
Correction des options de gestion des documents numériques, correction de l'application de ces options.

#43917 : Enrichissement ArteVOD et entités html
Décodage des entités html du contenu des notices avant de les intégrer dans l'entrepôt.

#43957 : Relations entre notices
Correction de la gestion des relations réciproques en import de notices, selon le paramétrage choisi.

#44127 : Connecteur OAI sortant : Gestion des notices supprimées
Dans le connecteur OAI sortant, les notices supprimées sont incluses dans le compte total ("completeListSize").
Ces notices sont insérées à la fin de la liste et non plus sur chaque page.
Elles prennent en compte les intervalles de dates spécifiés dans la requête ("from" et "until")
Dédoublonnage des notices présentes dans plusieurs sets.

#44270 : Modification automatique de la date des avis
Correction sur la modification automatique de la date des avis en mise à jour de base de données

---------
Autorités
---------

#40751 : Impression du thésaurus
Correction de la génération du contenu lorsque le PMB est déclaré en ISO-8859-1 et que certains caractères windows CP-1252 ont été saisis en base de données.

#39791 : Modification de la méthode "get_isbd" dans la classe "titre_uniforme"
Si l'isbd du titre uniforme est vide, on le génère et on le retourne.

#40698 : Problème de navigation sur les entités liées d'une autorité
Suite à l'enregistrement d'une autorité, la navigation sur les entités liées ne fonctionnait pas.

#42672 : Détail d'une catégorie
Affichage des catégories spécifiques par ordre alphabétique.

#42738 : Formulaire de modification d'une catégorie
Les liaisons de cette catégorie sont désormais triées par ordre alphabétique.

#42990 : Sphinx - Ajout des éditeurs dans la mécanique d'indexation
Ajout des éditeurs dans la mécanique d'indexation de sphinx

#43319 : RMC autorités : Recherche de concepts par le schéma
La recherche des concepts par leur schéma dans la RMC autorité fonctionne.

#43488 : Remplacement d'une catégorie
A la fin du remplacement, la catégorie remplacée n'était pas supprimée.

#44120 : Remplacement d'autorité
Prise en compte de la variable no_display permettant de ne pas afficher l'autorité à remplacer dans la liste de sélection de l'autorité finale.

#44261 : Vignettes d'autorités
Suppression de la vignette en suppression d'autorité

---------
Catalogue
---------

#39849 : Import Z3950 et titres uniformes
Correction de l'erreur générée par la présence d'un titre uniforme en import Z3950.

#39962 : Gestion du mappage des formulaires
Correction d'une anomalie dans l'algo pour déterminer si un formulaire est dérivable ou non

#40321 : RMC : Recherche booléenne sur les champs persos
Recherche multicritère sur les champs persos compatibles avec la nouvelle méthode.
De plus une recherche * sur un critère de champ perso ne ressort que les notices dont ce champ est renseigné.

#40325 :  Harmonisation des boutons dans la gestion des avis
Harmonisation de l'ordre d'affichage des boutons en gestion des avis

#40415 : Problème pour éditer les grilles de notices quand on change le type de doc
En édition de grille :
Il n'était plus possible d'éditer les grilles après avoir changé le type de document sur les grilles de périodiques, d'articles et de bulletins

#40536 : Recherche dans les notices
De façon aléatoire certaines recherches dans les notices ne donnaient pas de résultat et généraient une erreur MySQL (Vu sur un serveur Windows)

#40579 : Transfert entre paniers
Correction du transfert entre un panier de bulletins et un panier de notices.

#40629 : Procédures distantes
Correction de l'exécution et de l'import des procédures distantes, dans les procédures paniers et dans les actions personnalisables.

#40822 : Caractères accentués dans les listes MARC
Si la valeur commence par un caractère accentué, correction de l'affichage de l'abécédaire et des valeurs associées à une initiale.

#40920 : Pop-up de sélection d'autorité
Correction de l'affichage pour une autorité comportant un apostrophe dans son ISBD.

#40968 : Mauvaise prise en compte du paramètre numero_exemplaire_auto_script
Si le fichier du script numero_exemplaire_auto_script n'existe pas prise en compte du script par défaut

#41055 : Import des concepts en Z3950 "Fatal Error"
Correction de la "Fatal Error" sur la fonction "traite_concepts_for_form"

#41326 : Recherche sphinx sur les documents numériques | Report en 5.0
Report en 5.0 de la recherche sphinx sur les documents numériques

#41450 : Formulaire de création d'un auteur à partir d'une notice
Suppression de l'autocompletion sur le champ nom dans le formulaire de création d'un auteur

#41487 : Ajout des notices au panier avec sphinx activé
Il était impossible d'ajouter des notices au panier à la suite d'une recherche.

#41522 : Requete RFID
lorsque la RFID est décochée dans les préférences utilisateurs, il ne faut pas envoyer les requêtes

#41555 : Application des droits sur l'ajout des notices à un panier
Après une recherche auteur/titre, sur la page de résultat, lors de l'ajout des notices au panier, les droits d'accès n'étaient pas appliqués.

#42173 : Erreur fatale à l'enregistrement d'un exemplaire d'un numéro de périodique
Erreur liée à Sphinx, modification de l'indexation.

#42245 : Espaces de contribution : Gestion des droits d'accès
Gestion des droits d'accès sur les documents numériques et correction des droits d'accès de notice.

#42348 : Formulaires de contributions : Equations de recherche sur les catégories
Les équations de recherche sur les catégories fonctionnent correctement.

#42454 : Création de procédure panier
Correction de l'utilisateur autorisé par défaut.

#42685 : Masque de saisie de notices
La grille de saisie de notice n'était pas appliquée à la suite d'une éventuelle suppression du premier onglet apparaissant dans un formulaire d'édition de notice.

#42702 : Historique des recherches
Correction de l'ajout à l'historique de recherches en lien avec les autorités.

#42895 : Masque de saisie de notices : Ajout de concepts
Correction de l'ajout multiple de concepts au sein d'un formulaire de notices suite à une modification de grille.

#43000 : Entête de notice et auteurs
En affichage réduit de gestion, si la notice ne comporte aucun auteur principal, seul le premier autre auteur est affiché.

#43606 : Interrogation serveur Z3950 via la recherche externe "Connecteurs"
Correction de la requête envoyée au serveur qui ne renvoyait plus de résultat.

#43667 : Modification d'un abonnement
Correction de l'affichage du prix dans le formulaire.

#43746 : Infobulle dans les recheches multicritères
Ajout d'un title à l?élément [...] en recherche multicritère de catalogage et d'autorités.

#43830 : Nomenclatures : Génération de sous-manifestations
Correction d'un problème de génération de sous-manifestations lorsqu'il y a deux formations de même type

#43949 : Affichage des entités HTML dans les ISBD de notices
Protection des entités HTML afin qu'elles s'affichent correctement dans les en-têtes et ISBD de notices.

#44163 : Relations entre notices : Liens entre le bulletin et le périodique
Correction sur la perte du lien entre la notice de bulletin et son périodique

#44325 : Recherche externe et recherches spéciales
Affichage des critères de recherches spéciales lorsque le paramètre général "extended_search_dnd_interface" est activé.

-----------
Circulation
-----------

#42670 : Sélecteur action dans les relances
Correction de la valeur de l'action "Ne rien faire" dans le sélecteur du module de relances.

#39873 : Pret mode manuel en rfid
Pret mode manuel (douchette) en rfid active redevient fonctionnel

#40137 : Recherche dans les lecteurs
Pour la recherche dans les lecteurs, modification pour utiliser une table MySQL temporaire à la place d'une table persistante. 

#40326 : Ajout d'un message manquant
Ajout d'un message d'en-tête manquant pour l'action mailing des paniers en circulation.

#40570 : Actions rapides
Correction de l'enregistrement de la localisation du document par défaut en création d'exemplaire

#41512 : Forcage d'un prêt express
Correction d'une erreur bloquant le forçage d'un prêt express.

#41949 : Transfert entre paniers d'emprunteurs
Correction de la vérification des droits d'accès aux différents paniers.

#42926 :  Problème sur les titres lors d'un export tableur en recouvrement
Correction d'un problème sur les titres lors d'un export tableur en recouvrement.

#42961 : Auto-complétion des professions
Correction de la requête qui renvoyait des doublons de libellés.

#43556 : tableau de bord et requetes ajax asynchrones
Toutes les requêtes ajax du tableau de bord se font maintenant en mode asynchrone pour ne pas figer le navigateur lors de la saisie de code barres

--------
Demandes
--------

#41340 : Génération de rapport de demande au format rtf
Correction de la gestion de l'encodage pour les PMB en UTF-8.

------
Divers
------

#41159 : Encodage lors de conversion/import via les connecteurs
Lors de la conversion via les fonctions de WebServices les accents étaient encodés deux fois dans les PMB en iso-8859-1.

#39969 : Fonctions d'import modèle
Globalisation du répertoire des classes pour éviter une erreur fatale à l'export sur certaines fonctions.

#40288 : Recherches : Calcul de pertinence
Optimisation du calcul de pertinence. 
La table temporaire de résultats de recherche atteignait des limites SQL provoquant des lenteurs et des erreurs dans les listes de résultats.

#41915 : Ajout d'un cas "iso-8859-1" dans les fonctions de nettoyage de chaînes de caractères
Dans les fonctions qui nettoient les chaînes de caractères, on ne testait que les encodages "utf-8" et "iso8859-1". Or, dans certains cas, l'encodage est "iso-8859-1". Ce dernier cas est maintenant pris en compte.

#41927 : Affichage des icones
Correction de la fonction get_url_icon permettant depuis la gestion d'afficher des images de l'opac.

#42046 : PMB ISO-8859-1 : Correction d'encodage du tableau de bord
Les éléments du tableau de bord n'étaient pas affichés sur les PMB en ISO-8859-1 lorsque le contenu incluait des accents.

#42732 : Erreur à l'appel de propriétés non existantes sur les articles et les sections dans les templates django
Correction d'une erreur fatale suite à une récursivité trop prononcée dans le cmsLookup de pmbh2o.

#42949 : Facettes sur les concepts
Les facettes sur les concepts sont de nouveaux fonctionnelles

#43150 : Indexation des champs personnalisés
Conservation des mots vides lors de l'indexation des champs personnalisés

#43794 : Fichier de messages espagnols
Correction d'un message posant problème avec la structure du fichier.

---
DSI
---

#41144 : Veilles : surveillance de site web
Correction de l'encodage des items si le PMB est installé en iso-8859-1, et correction de la récupération des liens.

#41254 : Veilles : surveillance de site web
Amélioration de la récupération des items selon l'encodage de la source. Ajout d'un paramètre permettant d'utiliser la base de l'url de la source si les liens des items sont relatifs.

#41288 : Formulaire de bannette publique
Correction de l'affichage de deux sélecteurs.

#42478 : Liste des notices dans les bannettes
Correction de la sélection des notices à diffuser selon le critère de groupement par champ personnalisé.

#43612 : Affichage de l'équation dans l'entête des bannettes
Correction du remplacement du motif de l'équation.

--------
Editions
--------

#40670 : Générations de lettres : Prise en compte du message "Tel 1 :"
Prise en compte du message "Tel 1 :" dans les lettres PDF (retards, relances,..). 
Le message appelé n'était pas le bon.

#43069 : Cache des images dans l'édition d'une bibliographie
L'URL de l'image avec le cache paramétré faisait référence à la gestion et non à l'Opac.

----
OPAC
----

#39793 : Impression PDF et vignettes des notices
Remise en place de l'affichage des vignettes qui étaient bloquées dans l'impression PDF en template par défaut.

#39842 : Visionneuse de documents numériques
Correction du chargement des documents dans la visionneuse quand ceux-ci sont placés dans des sous-répertoires du répertoire d'upload.

#40256 : Templates Django : Problème d'affichage des avis
Modification du template "record_extended_display.tpl.html" :
Avant :
ligne xx : {% if global.opac_avis_display_mode == 0 %}
ligne xxx : {% if global.opac_avis_display_mode == 1 %}
Après :
ligne xx : {% if global.opac_avis_display_mode == '0' %}
ligne xxx : {% if global.opac_avis_display_mode == '1' %}
Le type "text" n'est pas égal au type "int"

#40502 : Flux RSS d'une recherche
Correction de l'appel des classes d'affichage personnalisées lors de la génération du flux.

#40669 : Correction templates django common de notices
Correction du titre au survol des vignettes des notices en affichage django common réduit et détaillé.

#40690 : Correction templates django de notices common bretagne
Ajout d'une séparation entre le numéro du bulletin et la date de parution du bulletin dans les templates django de notices common bretagne en affichage réduit des articles.

#41029 : Page d'accueil via une vue
Correction d'une régression liée au ticket #31957.
Paramétrer le fait de tomber sur une recherche prédéfinie en page d'accueil via le paramètre first_page_params n'était plus possible.

#39925 : Enregistrement des avis
Correction de l'enregistrement des avis lorsque le paramètre OPAC avis_allow est configuré avec la valeur 3 (ajouts anonymes possibles).

#40906 : Avis privés sans être authentifié
Il était possible d'ajouter des avis privés sans être connecté, ils devenaient orphelins.

#40990 : Array juste après le body
Si le répertoire style demandé n'est pas présent, une chaine vide est retourné, au lieu d'un Array

#41211 :  Etagère vide
Ajout de fermeture de div manquante

#41307 : Selecteur de catégories
Erreur d'inclusion de notice_tpl_gen

#41329 : Mode d'affichage personnalisé par vue
Correction de l'application d'un mode d'affichage si celui-ci n'est pas disponible dans la vue en cours.

#41544 : Correction de l'affichage de la phrase de tri par défaut en résultat de recherche à l'OPAC
L'affichage de la phrase de tri par défaut en résultat de recherche à l'OPAC s'affiche correctement.

#41545 : Sélecteur d'autorité
Correction du style pour le sélecteur de catégories, correction du paginateur pour les sélecteurs d'auteur, de catégorie et de titre uniforme.

#41669 : Espaces de contribution : correction des balises
Suppression d'une balise <div> fermée inopinément dans les espaces de contribution.

#41719 : Espaces de contribution : Gestion des droits d'accès par accès direct
Les droits d'accès sont pris en compte correctement lorsqu'on tente d?accéder aux espaces / scénarios / formulaires directement depuis leur URL.

#42275 : Surlignage des mots de la recherche
Correction de la fonction de surlignage quand le portail est activé.

#42329 : Formulaire d'impression OPAC
Ajout d'un titre aux formulaires d'impression de l'OPAC. Changement de contenu dans l'infobulle d'impression d'un résultat de recherche OPAC.

#42425 : Recherche depuis une url courte
Correction de la gestion des éléments de recherche pour éviter les erreurs dans l'appel de certaines urls courtes.

#42764 : Ajout de balises html dans l'équation de recherche
En résultats de recherche niveau 2 des balises html ont été ajoutées afin de permettre une mise en forme et interactivité.

#42772 : Visionneuse de documents numériques
Correction de l'affichage des documents dans la visionneuse suite à l'application d'une facette lors d'une recherche.

#42775 : Paramètre "concepts_active" à l'OPAC
Prise en compte pour la recherche à l'OPAC de l'activation des concepts.

#42781 : Sélection de catégorie en recherche multicritères
Correction de la navigation dans les termes spécifiques.

#42789 : Disponibilité des exemplaires
Correction des informations retournées et du template django sur l'affichage réduit des notices.

#42984 : Export d'un panier
Correction de la liste déroulante de sélection du format d'export.

#43135 : Recherche multicritère et autolevel2
Si l'autolevel2 est à 1, correction de l'affichage des résultats de recherche contenant une sélection d'autorité.

#43259 : Globalisation des variables PHP de templates PMB
Il faut désormais déclarer les variables en globales dans les fichiers *.tpl.php pour qu'elles soient reconnues dans le contexte global

#43424 : [Vues OPAC] Corrections dans la gestion de l'environnement
Problème rencontré : avec les vues OPAC activées, de nombreux templates sont chargés avant la récupération des messages et des paramètres spécifiques à la vue sélectionnée.

#43431 : Application d'une facette combinant plusieurs critères
Correction du résultat quand les critères combinés ne renvoient pas de notice.

#43500 : Prise en compte de paramètre à l'OPAC
Prise en compte du paramètre opac_cart_allow à l'affichage de la liste des prêts de l'usager.

#43533 : Enrichissement ArteVOD
Correction de la synchronisation du connecteur, et de l'affichage du contenu au sein de l'enrichissement.

#43549 : Popup de sélection de concept en multicritère OPAC
Correction de l'impossibilité d'ouvrir la popup de sélection d'un concept en multicritère OPAC.

#43704 : Dépouillements d'un bulletin
Correction de l'affichage des dépouillements sur l'affichage standard, selon le paramétrage, si le bulletin possède une notice.

#44027 : Recherche personnalisée cnl
Correction d'un libellé de menu déroulant dans la fonction de recherche personnalisée à l'opac.

#44414 : RMC OPAC : Sélecteur de concept
Le sélecteur de concepts dans la multicritères à l'OPAC est de nouveau disponible.

#44469 : CSS du partage de résultat de recherche
Modification du la feuille de style afin de rendre la fonction compatible tout navigateur.
Ajout d'une animation pour les navigateurs récents.

-------
Portail
-------

#40604 : Conditions d'affichage des pages FRBR
Correction sur les conditions d'affichage des pages FRBR. Les conditions ou les tris étaient enregistrés avec l'identifiant 1.

#41177 : Permettre de trier du contenu éditorial sur un CP
Il est désormais possible de trier les valeurs de champs personnalisés dans le contenu éditorial.

#41208 : Affichages Django : Désactivation du panier de lecteur
Prise en compte de l'activation ou non de la mise en panier sur l'affichage des bulletins et des notices de bulletin.

#41550 : Gestion du cache des vignettes des documents du portefolio
Le chemin des vignettes des documents du portefolio n'était pas bien pris en compte avec le cache pour les serveurs mutualisés.

#42013 : Correction du bouton "+" pour tout sélectionner en édition d'élément du portfolio
Cela sélectionnait uniquement le premier.

#42061 : Sources de données "Notices des catégories d'une rubrique" pour une liste de notices
La sélection de "notices des catégories d'une rubrique" comme source de données d'une liste de notices ne retournait aucun résultat. C'est corrigé.

#43170 : Portail : Enregistrement du contexte dans les PMB en iso-8859-1
Enregistrement des données de contexte du portail en session pour les PMB encodés en ISO-8859-1.

#44247 : Source de donnée bannette : Sélection manuelle
Prise en compte de toutes les bannettes, et non des bannettes automatiques seulement.

#44278 : Placement du bouton "vider le cache des images"
Le bouton "vider le cache des images" est affiché à la ligne avec le bouton "Vider le cache"


*******************
EVOLUTIONS


--------------
Administration
--------------

#40361 : Champ retourné par les webservices
Ajout du champ "codestat" dans les données retournées par les fonctions des webservices PMB.

#40059 : Formulaire de contact : Suppression d'objets
Ajout du bouton en édition d'un objet

#42273 : Description pour la recherche dans les concepts à l'OPAC
Édition du message associé au paramètre "modules_search_concept".

#43159 : Conversion Prisme
Ajout d'une correspondance de type de document dans les conversions Prisme vers unimarc et Prisme vers XML unimarc.

#44264 : Conversion memodocnet
Ajout de la conversion memodocnet BCDI vers PMB 

#44358 : Imprimante tickets de prêt
Ajout d'un paramètre permettant de gérer plusieurs imprimantes ticket de prêt, éventuellement gérées par plusieurs raspberry.

---------
Autorités
---------

#40984 : Multicritères concepts :  recherche sur tous les champs littéraux
Il est désormais possible de rechercher sur tous les champs littéraux (notes, exemple, définition...).

#41607 : RMC autorités : Ajout d'un critère sur le thésaurus des catégories
Possibilité d'ajouter un critère sur le thésaurus des catégories.

---------
Catalogue
---------

#40476 : ArteVOD : Evolution du webservice
Évolution du connecteur ArteVOD pour s'adapter à l'évolution du web-service.
Récupération du nombre total d'enregistrements et refonte de l'enrichissement.
/!\ Étant donné que le template d?enrichissement a été modifié, il est conseillé de repartir de celui défini par défaut (En enregistrant la source après avoir vidé le champ de template ).

#39686 : Liens entre notices
Choix des liens à conserver en import et remplacement de notices.

#39915 : Harmonisation des popups dans la gestion des périodiques
Dans la popup des calendriers de la gestion des périodiques le bouton de fermeture est maintenant sous forme de picto.
Une class "panel-close" a été ajoutée afin de pouvoir mettre en forme cet élément d'interface.

#40765 : Affichage d'une notice de bulletin
Affichage du carré de couleur du statut lorsqu'une notice de bulletin est présente.

#41040 : Valeur par défaut en création de document numérique
Ajout d'une valeur par défaut au champ "propriétaire" en création de document numérique.

#41932 : Alerte de suggestion à traiter
Prise en compte du paramètre de localisation des suggestions pour l'affichage de l'alerte ou non.

-----------
Circulation
-----------

#41133 : RFID indication antivol sur retour de document
Ajout de l'indication antivol sur retour de document ( led qui flash).
Retour plus rapide: la commande antivol est envoyée avant la lecture rfid

#41393 : Actions rapides en circulation
Ajout du choix de la localisation par défaut en visualisation des réservations.

#41694 : Statistiques de fréquentation : statistiques horaires
Les statistiques sont enregistrés avec la date et l'heure.

------
Divers
------

#40928 : Options pour le debogage - Afficher les erreurs PHP 
Ajout de deux paramètres "display_errors" dans les paramètres généraux et dans la section "OPAC" pour faciliter le débogage d'anomalies.
Essentiellement utile pour les développeurs

#41886 : Optimisation de l'indexation des concepts lorsque Sphinx est activé 
Statification de l'instanciation du sphinx_indexer

#43084 : Ajout du méthode de suppression de notice dans l'api
Ajout de deux méthodes : 
- une pour supprimer une liste de notices(monographie ou périodique) mis dans un tableau
- une pour vérifier l'utilisation d'une notice

#43752 : Ajout d'un champ bulletin dans les formulaires de contribution
Ajout d'un champ bulletin dans les formulaires de contribution de type "notice".
Si ce champ est rempli, que le type de document est défini à "Article" et le niveau hiérarchique à "2". Alors, l'article sera automatiquement rattaché au bulletin sélectionné.

---
DSI
---

#41471 : Informations reprises en résumé des items de veille
Pour la source "notices de la base", possibilité de personnaliser les informations reprises dans le résumé des items, à l'aide d'un template de notices.

--------
Editions
--------

#39930 : Coloration syntaxique dans les templates de notices et de bannettes
Identique au contenu éditorial et aux pages FRBR

----
OPAC
----

#38132 : Ajout entête pour l'impression par panier
Ajout entête et pied de page pour l'impression par panier : impression, PDF, traitement de texte, mail. Template éditable en Administration > Template de Mail > Template impression de panier. Le paramètre OPAC print_cart_header_footer doit contenir l'id du template.

#40432 : Affichage Django : Classement des autorités personnalisées
Nouvelle propriété {{ record.authpersos_ranked }}
Tableau groupé par identifiant d'autorité perso

#40538 : Flux RSS: Optimisation requete de recherche de document numérique et gestion des notices de bulletins
Optimisation de la requete de recherche de document numérique d'une notice dans la construction des flux RSS et prise en compte des notices de bulletin

#41578 : Formulaires de contribution | Prise en charge des répertoires d'upload navigables
Possibilité de naviguer dans les répertoires d'upload déclarés comme navigables dans les formulaires de contribution.

#42493 :  Informations de notices dans la surcharge de méta données
Dans le module portail "Surcharges de méta-données", lorsque l'on choisit comme source de donnée "depuis une notice", on récupère les informations de la notice.

#43107 : Remplacement du pixel blanc par le no image
L'image de 2/2 pixels est maintenant remplacée par la no image du dossier style. Le remplacement est effectué directement dans le fichier opac_css/getimage.php.

#43311 : Permalink d'une notice invisible
Modification du libellé affiché lorsque la notice n'est pas visible. Nouveau message : "Vous ne pouvez pas accéder à ce document."

#43416 : Formulaires de contribution : Alerte au dépôt d'un document qui dépasse le poids autorisé
Une alerte est envoyée lorsqu'un document dépasse la limite autorisée.

#43545 : Navigateur de périodiques
Ajout d'un paramètre OPAC "perio_a2z_default_active_subscription_filter" permettant de cocher par défaut la case "abonnement actif".

#43813 : Contribution: Tri par ordre alphabétique de la liste des formulaires côté OPAC 
Liste des formulaires classée par ordre alphabétique.

#44126 : Pouvoir modifier son alerte privée
Il est désormais possible de ré-éditer son alerte privée.

#44371 : Modification du répertoire temporaire de mpdf
Passage du dossier temporaire de la classe MPDF dans le dossier temp de PMB.

-------
Portail
-------

#39854 : Liste de rubriques : Rubriques des catégories d'une rubrique  
Nouvelle source de données dans le module "Liste de rubriques"

#40031 : Surcharge de méta-données : améliorations sur l'ergonomie
Possibilité de modifier une méta-donnée
Permettre de choisir le(s) groupe(s) à appliquer dans le cadre

#40038 : Module métadonnées / notice : pouvoir choisir un template de notices
Pour la source de donnée "Méta-données d'une notice"

#40742 : Surcharge de méta-données : Affichage du titre de bulletin
Affichage du titre de la notice de bulletin si le titre du bulletin est vide

#40894 : Bouton vider le cache des images
Ajout d'un bouton dans la gestion pour vider le répertoire temp des images

#41202 : Module "Recherche" : Ouverture des liens dans un nouvel onglet
Cases à cocher dans les autres liens pour avoir la possibilité de les ouvrir dans un nouvel onglet

#43492 : Ajout de l'éditeur HTML dans le module "Code HTML"
Ajout de l'éditeur HTML dans la vue du module "code html".

#44282 : Liste d'étagères : Répertoire de templates à utiliser
Possibilité de choisir un répertoire de templates pour la vue des notices appartenant aux étagères sélectionnées.
Prise en compte du paramètre OPAC "etagere_notices_format" pour le mode d'affichage des notices

#44439 : Ajout de toolkit dans l'onglet portail
De nouveaux toolkits ont été ajouté dans le portail:
- uikit 3 Version 3.0.0-Beta.40 _(uniqument en version DEV de pmb)_
- Font Awesome Version 5.0.6 
- Masonry Version 4.2.0 

#44408 : Toolkits : Arborescence générique
Mécanique générique d'ajout de nouveaux toolkits.
- pmb/opac_css/styles/common/toolkits/nom_du_toolkit/js/ (Tous les fichiers à la racine suffixé par ".min.js" seront automatiquement chargés lorsqu'il est activé)
- pmb/opac_css/styles/common/toolkits/nom_du_toolkit/css/ (Tous les fichiers à la racine suffixé par ".min.css" de même nom que le javascript seront automatiquement chargés lorsqu'il est activé)
Composants activés lorsque l'option est cochée (chargement identique) :
- pmb/opac_css/styles/common/toolkits/nom_du_toolkit/js/components/
- pmb/opac_css/styles/common/toolkits/nom_du_toolkit/css/components/


*******************
FONCTIONNALITES


#40107 : Autopostage sur les concepts
- ajout de l'autopostage sur les concepts en recherche simple en gestion
- ajout de l'autopostage sur les concepts en recherche multi-critères de notices en gestion et en OPAC
- ajout de l'autopostage sur les concepts en recherche multi-critères d'autorités en gestion
- ajout des notices indexées par les concepts autopostés sur la fiche d'un concept

#40677 : Harmonisation et corrections du DOM
Harmonisation du dom entre les différentes pages.
Travail de fond toujours en cours.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.3                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


--------------
Administration
--------------

#39334 : Notices des connecteurs sortants
Correction de la génération du cache des notices lors du rafraichissement des sets du connecteur. Correction de la requête de sélection des notices en cache, quand la date de modification des exemplaires est prise en compte.

#39586 : Webservice pour l'automate de prêt
Correction de la suppression des prêts temporaires.

---------
Catalogue
---------

#39136 : Reprise de la notice dans la dérivation oeuvre
Correction d'une anomalie dans le mappage des champs dans la création d'une oeuvre dérivée depuis une notice.
Le champ "notices liées" n'était pas correctement repris.

#39574 : Problème d'encodage au niveau des notifications
Suppression d'un double encodage sur le contenu HTML de la zone de notification

-----------
Circulation
-----------

#39385 : Mise en cache des photos de lecteurs de PMB
Le paramètre de taille maximum des photos des lecteurs n'était plus pris en compte à l'affichage avec la mise en place du cache des images.

#39479 : Vérification de réservation lors d'un retour de transfert
Lors du retour d'un exemplaire sur son site d'origine, vérification de la possibilité de satisfaire une réservation.

------
Divers
------

#39275 : Correction pour une connexion à un service Sphinx distant
Correction d'un bug sur la connexion à un service Sphinx.
Le paramètre sphinx_mysql_connect n'était pas pris en compte pour la connexion à l'API de recherche Sphinx.
Cela ne fonctionnait donc pas lorsque l'on voulait se connecter à un service Sphinx distant 

----
OPAC
----

#39283 : Liste des bannettes visibles
Correction de l'affichage de la liste des bannettes en fonction de la catégorie de l'emprunteur et de son appartenance à d'éventuels groupes.

-------
Portail
-------

#39409 : Affichage des logos d'article ou de rubrique
Correction de l'affichage lorsque l'élément éditorial ne possède pas de logo.


*******************
EVOLUTIONS


--------------
Administration
--------------

#39292 : Formulaire de création d'action personnalisable et de procédure panier
En création d'action personnalisable et de procédure panier, l'utilisateur courant est autorisé par défaut. Si une procédure existe déjà, on ré-affiche le formulaire de création.

------
Divers
------

#39447 : Optimisations de l'affichage des champs persos dans les formulaires
Optimisations liées à la réduction du nombre de fichiers javascript inclus au chargement d'un formulaire contenant des champs persos.

----
OPAC
----

#39506 : [Affichages Django] Affichage du titre du bulletin dans les infos de bulletinage
Titre du bulletin dans les infos de bulletinage : {{ record.bul_info.bulletin_title }}

-------
Portail
-------

#39474 : Format de fichier pour les logos du contenu éditorial
Indication des formats conseillés sur le formulaire d'upload des logos.



************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.2                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


*******************
ANOMALIES


-----------
Circulation
-----------

#39058 : Débit de l'abonnement depuis une fiche lecteur
Le débit de l'abonnement ne se fait que si une prolongation a été faite.

------
Divers
------

#39099 : Correction du chargement des nomenclatures en modification de notices
Corrections en 2 temps : ajout de l'attribut startOpen="no" dans le gabarit pour éviter que les listes d'autorités soit dépliées par défaut

----
OPAC
----

#38710 : Recherche multi-critère associée à une vue OPAC
Correction de la gestion des apostrophes dans l'enregistrement de la recherche associée à la vue.

#38715 : Correction templates common django de notices
Correction du champs "Mots clés" qui apparaissait tout en haut de la notice quand le paramètre OPAC "thésaurus" était à 0.




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_5.0.1                                                                  *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


Voir sur le site www.sigb.net :
Nouveautés : http://www.sigb.net/newsletter/nouveautes_50/nouveautes_pmb_50.pdf
Améliorations : http://www.sigb.net/newsletter/nouveautes_50/ameliorations_pmb_50.pdf




************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
*                                    CHANGE_LOG_4.2.12                                                                 *
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************
************************************************************************************************************************


Voir le fichier changelogs42.txt dans le répertoire racine de PMB (ajoutez "42" dans l'URL de cette page !)